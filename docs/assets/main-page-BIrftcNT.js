import{S as Z,p as B,r as d,s as M,a as S,n as T,i as N,b as A,t as ee,c as j,f as te,d as se,e as W,g as V,h as m,j as ie,u as re,k as I,v as ae,l as i,K as ne,C as oe,P as ce}from"./index-6qqa497Q.js";import{a as G,B as C}from"./Button-zRj96etr.js";import{Q as he,S as ue}from"./QuizList-Dnp_ySnp.js";var le=class extends Z{constructor(e,t){super(),this.options=t,this.#s=e,this.#r=null,this.#i=B(),this.bindMethods(),this.setOptions(t)}#s;#e=void 0;#p=void 0;#t=void 0;#n;#u;#i;#r;#m;#l;#d;#o;#c;#a;#f=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#e.addObserver(this),H(this.#e,this.options)?this.#h():this.updateResult(),this.#_())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return q(this.#e,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return q(this.#e,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#b(),this.#S(),this.#e.removeObserver(this)}setOptions(e){const t=this.options,s=this.#e;if(this.options=this.#s.defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof d(this.options.enabled,this.#e)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#R(),this.#e.setOptions(this.options),t._defaulted&&!M(this.options,t)&&this.#s.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#e,observer:this});const r=this.hasListeners();r&&$(this.#e,s,this.options,t)&&this.#h(),this.updateResult(),r&&(this.#e!==s||d(this.options.enabled,this.#e)!==d(t.enabled,this.#e)||S(this.options.staleTime,this.#e)!==S(t.staleTime,this.#e))&&this.#v();const a=this.#y();r&&(this.#e!==s||d(this.options.enabled,this.#e)!==d(t.enabled,this.#e)||a!==this.#a)&&this.#g(a)}getOptimisticResult(e){const t=this.#s.getQueryCache().build(this.#s,e),s=this.createResult(t,e);return fe(this,s)&&(this.#t=s,this.#u=this.options,this.#n=this.#e.state),s}getCurrentResult(){return this.#t}trackResult(e,t){return new Proxy(e,{get:(s,r)=>(this.trackProp(r),t?.(r),r==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#i.status==="pending"&&this.#i.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(s,r))})}trackProp(e){this.#f.add(e)}getCurrentQuery(){return this.#e}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const t=this.#s.defaultQueryOptions(e),s=this.#s.getQueryCache().build(this.#s,t);return s.fetch().then(()=>this.createResult(s,t))}fetch(e){return this.#h({...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#t))}#h(e){this.#R();let t=this.#e.fetch(this.options,e);return e?.throwOnError||(t=t.catch(T)),t}#v(){this.#b();const e=S(this.options.staleTime,this.#e);if(N||this.#t.isStale||!A(e))return;const s=ee(this.#t.dataUpdatedAt,e)+1;this.#o=j.setTimeout(()=>{this.#t.isStale||this.updateResult()},s)}#y(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#e):this.options.refetchInterval)??!1}#g(e){this.#S(),this.#a=e,!(N||d(this.options.enabled,this.#e)===!1||!A(this.#a)||this.#a===0)&&(this.#c=j.setInterval(()=>{(this.options.refetchIntervalInBackground||te.isFocused())&&this.#h()},this.#a))}#_(){this.#v(),this.#g(this.#y())}#b(){this.#o&&(j.clearTimeout(this.#o),this.#o=void 0)}#S(){this.#c&&(j.clearInterval(this.#c),this.#c=void 0)}createResult(e,t){const s=this.#e,r=this.options,a=this.#t,u=this.#n,n=this.#u,c=e!==s?e.state:this.#p,{state:f}=e;let o={...f},b=!1,h;if(t._optimisticResults){const l=this.hasListeners(),R=!l&&H(e,t),_=l&&$(e,s,t,r);(R||_)&&(o={...o,...se(f.data,e.options)}),t._optimisticResults==="isRestoring"&&(o.fetchStatus="idle")}let{error:U,errorUpdatedAt:D,status:y}=o;h=o.data;let L=!1;if(t.placeholderData!==void 0&&h===void 0&&y==="pending"){let l;a?.isPlaceholderData&&t.placeholderData===n?.placeholderData?(l=a.data,L=!0):l=typeof t.placeholderData=="function"?t.placeholderData(this.#d?.state.data,this.#d):t.placeholderData,l!==void 0&&(y="success",h=W(a?.data,l,t),b=!0)}if(t.select&&h!==void 0&&!L)if(a&&h===u?.data&&t.select===this.#m)h=this.#l;else try{this.#m=t.select,h=t.select(h),h=W(a?.data,h,t),this.#l=h,this.#r=null}catch(l){this.#r=l}this.#r&&(U=this.#r,h=this.#l,D=Date.now(),y="error");const O=o.fetchStatus==="fetching",E=y==="pending",w=y==="error",k=E&&O,F=h!==void 0,p={status:y,fetchStatus:o.fetchStatus,isPending:E,isSuccess:y==="success",isError:w,isInitialLoading:k,isLoading:k,data:h,dataUpdatedAt:o.dataUpdatedAt,error:U,errorUpdatedAt:D,failureCount:o.fetchFailureCount,failureReason:o.fetchFailureReason,errorUpdateCount:o.errorUpdateCount,isFetched:o.dataUpdateCount>0||o.errorUpdateCount>0,isFetchedAfterMount:o.dataUpdateCount>c.dataUpdateCount||o.errorUpdateCount>c.errorUpdateCount,isFetching:O,isRefetching:O&&!E,isLoadingError:w&&!F,isPaused:o.fetchStatus==="paused",isPlaceholderData:b,isRefetchError:w&&F,isStale:P(e,t),refetch:this.refetch,promise:this.#i,isEnabled:d(t.enabled,e)!==!1};if(this.options.experimental_prefetchInRender){const l=x=>{p.status==="error"?x.reject(p.error):p.data!==void 0&&x.resolve(p.data)},R=()=>{const x=this.#i=p.promise=B();l(x)},_=this.#i;switch(_.status){case"pending":e.queryHash===s.queryHash&&l(_);break;case"fulfilled":(p.status==="error"||p.data!==_.value)&&R();break;case"rejected":(p.status!=="error"||p.error!==_.reason)&&R();break}}return p}updateResult(){const e=this.#t,t=this.createResult(this.#e,this.options);if(this.#n=this.#e.state,this.#u=this.options,this.#n.data!==void 0&&(this.#d=this.#e),M(t,e))return;this.#t=t;const s=()=>{if(!e)return!0;const{notifyOnChangeProps:r}=this.options,a=typeof r=="function"?r():r;if(a==="all"||!a&&!this.#f.size)return!0;const u=new Set(a??this.#f);return this.options.throwOnError&&u.add("error"),Object.keys(this.#t).some(n=>{const g=n;return this.#t[g]!==e[g]&&u.has(g)})};this.#x({listeners:s()})}#R(){const e=this.#s.getQueryCache().build(this.#s,this.options);if(e===this.#e)return;const t=this.#e;this.#e=e,this.#p=e.state,this.hasListeners()&&(t?.removeObserver(this),e.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#_()}#x(e){V.batch(()=>{e.listeners&&this.listeners.forEach(t=>{t(this.#t)}),this.#s.getQueryCache().notify({query:this.#e,type:"observerResultsUpdated"})})}};function de(e,t){return d(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function H(e,t){return de(e,t)||e.state.data!==void 0&&q(e,t,t.refetchOnMount)}function q(e,t,s){if(d(t.enabled,e)!==!1&&S(t.staleTime,e)!=="static"){const r=typeof s=="function"?s(e):s;return r==="always"||r!==!1&&P(e,t)}return!1}function $(e,t,s,r){return(e!==t||d(r.enabled,e)===!1)&&(!s.suspense||e.state.status!=="error")&&P(e,s)}function P(e,t){return d(t.enabled,e)!==!1&&e.isStaleByTime(S(t.staleTime,e))}function fe(e,t){return!M(e.getCurrentResult(),t)}var J=m.createContext(!1),pe=()=>m.useContext(J);J.Provider;function me(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var ve=m.createContext(me()),ye=()=>m.useContext(ve),ge=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},_e=e=>{m.useEffect(()=>{e.clearReset()},[e])},be=({result:e,errorResetBoundary:t,throwOnError:s,query:r,suspense:a})=>e.isError&&!t.isReset()&&!e.isFetching&&r&&(a&&e.data===void 0||ie(s,[e.error,r])),Se=e=>{if(e.suspense){const s=a=>a==="static"?a:Math.max(a??1e3,1e3),r=e.staleTime;e.staleTime=typeof r=="function"?(...a)=>s(r(...a)):s(r),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},Re=(e,t)=>e.isLoading&&e.isFetching&&!t,xe=(e,t)=>e?.suspense&&t.isPending,K=(e,t,s)=>t.fetchOptimistic(e).catch(()=>{s.clearReset()});function je(e,t,s){const r=pe(),a=ye(),u=re(),n=u.defaultQueryOptions(e);u.getDefaultOptions().queries?._experimental_beforeQuery?.(n),n._optimisticResults=r?"isRestoring":"optimistic",Se(n),ge(n,a),_e(a);const g=!u.getQueryCache().get(n.queryHash),[c]=m.useState(()=>new t(u,n)),f=c.getOptimisticResult(n),o=!r&&e.subscribed!==!1;if(m.useSyncExternalStore(m.useCallback(b=>{const h=o?c.subscribe(V.batchCalls(b)):T;return c.updateResult(),h},[c,o]),()=>c.getCurrentResult(),()=>c.getCurrentResult()),m.useEffect(()=>{c.setOptions(n)},[n,c]),xe(n,f))throw K(n,c,a);if(be({result:f,errorResetBoundary:a,throwOnError:n.throwOnError,query:u.getQueryCache().get(n.queryHash),suspense:n.suspense}))throw f.error;return u.getDefaultOptions().queries?._experimental_afterQuery?.(n,f),n.experimental_prefetchInRender&&!N&&Re(f,r)&&(g?K(n,c,a):u.getQueryCache().get(n.queryHash)?.promise)?.catch(T).finally(()=>{c.updateResult()}),n.notifyOnChangeProps?f:c.trackResult(f)}function X(e,t){return je(e,le)}const Ce=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Y=I("chevron-right",Ce);const Ie=[["path",{d:"M18 20a6 6 0 0 0-12 0",key:"1qehca"}],["circle",{cx:"12",cy:"10",r:"4",key:"1h16sb"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Oe=I("circle-user-round",Ie);const Ee=[["path",{d:"M12 2v13",key:"1km8f5"}],["path",{d:"m16 6-4-4-4 4",key:"13yo43"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}]],we=I("share",Ee);const Qe=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],ze=I("square-pen",Qe),Me=async e=>(await G.get(`/user/${e.id}`)).data;function Te(){const{tgWebAppData:e}=ae(),t={id:String(e?.user?.id||""),language:e?.user?.language_code||"ru",first_name:e?.user?.first_name||"",last_name:e?.user?.last_name||"",username:e?.user?.username||"",avatar:e?.user?.photo_url||""};return X({queryKey:["getUserData",t.id],queryFn:()=>Me(t),refetchOnMount:!1})}const Ne="_avatar_gqlys_1",qe={avatar:Ne},Pe=({image:e})=>{const[t,s]=m.useState(!1);return i.jsxs("div",{className:qe.avatar,children:[(!t||!e)&&i.jsx(Oe,{}),e&&i.jsx("img",{src:e,alt:"avatar",style:{opacity:t?1:0},onLoad:()=>s(!0)})]})},Ue="_userWelcome_1hj2l_1",De="_userInfo_1hj2l_6",Le="_welcome_1hj2l_13",ke="_welcomeDesc_1hj2l_23",Fe="_userStatistic_1hj2l_28",Be="_userStatisticItem_1hj2l_38",Ae="_userStatisticBtn_1hj2l_46",v={userWelcome:Ue,userInfo:De,welcome:Le,welcomeDesc:ke,userStatistic:Fe,userStatisticItem:Be,userStatisticBtn:Ae},We=()=>{const{data:e,isLoading:t}=Te(),s=e?.first_name||e?.username;return console.log(e,t),i.jsxs("div",{className:v.userWelcome,children:[i.jsxs("div",{className:v.userInfo,children:[i.jsx(Pe,{image:e?.avatar}),i.jsxs("p",{className:v.welcome,children:["Привет ",s&&i.jsxs("span",{children:[s,"!"]})]}),i.jsx("p",{className:v.welcomeDesc,children:"Время создать или пройти квиз!"})]}),i.jsxs("div",{className:v.userStatistic,children:[i.jsxs("p",{className:v.userStatisticItem,children:["Пройдено ",i.jsx("br",{})," квизов",i.jsx("span",{children:e?.quizzes_completed||0})]}),i.jsxs("p",{className:v.userStatisticItem,children:["Создано ",i.jsx("br",{})," квизов",i.jsx("span",{children:e?.quizzes_created||0})]}),i.jsxs("div",{className:v.userStatisticBtn,children:[i.jsx("span",{children:"В профиль"}),i.jsx("button",{type:"button",title:"в профиль",children:i.jsx(Y,{})})]})]})]})},He="t.me/simple_quizz_bot/app",$e="Приложение для прохождения и создания квизов!",Ke=()=>{const e=()=>{ne(He,$e)};return i.jsx(C,{onClick:e,after:i.jsx(we,{}),children:"Поделиться"})},Ve=async e=>(await G.get("/quiz",{params:e}))?.data;function Ge(){return X({queryKey:["getQuizList"],queryFn:()=>Ve({})})}const Je="_quizSection_367iu_1",Xe="_quizList_367iu_35",Ye="_quizAll_367iu_40",Q={quizSection:Je,quizList:Xe,quizAll:Ye},Ze=()=>{const{data:e,isLoading:t}=Ge();return i.jsxs("div",{className:Q.quizSection,children:[i.jsx("div",{className:Q.quizList,children:i.jsx(he,{view:"column",isLoading:t,data:e})}),i.jsx("div",{className:Q.quizAll,children:i.jsx(C,{to:"/quizzes",after:i.jsx(oe,{}),children:"Все квизы"})})]})},et="_container_13cq9_1",tt="_userData_13cq9_5",st="_actions_13cq9_9",z={container:et,userData:tt,actions:st};function ot(){return i.jsx(ce,{back:!1,children:i.jsxs("div",{className:z.container,children:[i.jsx("div",{className:z.userData,children:i.jsx(We,{})}),i.jsxs("div",{className:z.actions,children:[i.jsx(C,{to:"/create",after:i.jsx(ze,{}),children:"Создать квиз"}),i.jsx(Ke,{})]}),i.jsx(ue,{title:"Популярные тесты",actions:i.jsx(C,{style:"white",size:"sm",to:"/quizzes",after:i.jsx(Y,{color:"#333"}),children:"Cм. все"})}),i.jsx(Ze,{})]})})}export{ot as default};
