import{r as i,J as k,c as S,H as O,u as b,a as w,j as n,b as y,n as R,d as I,C as g,e as _,m as j,O as P,S as A}from"./index-duMPENMb.js";import{C as T}from"./circle-check-big-DAXDSnIe.js";import{u as z}from"./useTranslation-Dr7GNFlv.js";import{r as E}from"./index-C56OEWsn.js";import{u as $,r as W}from"./popupStore-DskkcXUi.js";import{B as M}from"./Background-CBGxKYRw.js";import"./buildUrl-gP7_0eZ0.js";import"./trash-2-vKMKbYb-.js";function C(e){return i.useMemo(()=>k(),[e])}const X=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],B=S("chevron-left",X);const H=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],q=S("user",H),V=[{id:1,title:"navigation.main",icon:O,link:"/"},{id:2,title:"navigation.quizzes",icon:T,link:"/quizzes"},{id:3,title:"navigation.profile",icon:q,link:"/profile"}],Y="_container_kfp16_1",F="_list_kfp16_16",G="_hide_kfp16_51",J="_item_kfp16_55",U="_active_kfp16_84",D="_icon_kfp16_88",d={container:Y,list:F,hide:G,item:J,active:U,icon:D},K=()=>{const{t:e}=z(),t=i.useRef(null),o=b(s=>s.isNavigationVisible),{pathname:c}=w();return i.useLayoutEffect(()=>{t?.current?.offsetHeight&&document.documentElement.style.setProperty("--navigation-height",t.current.offsetHeight+"px")},[]),n.jsx("div",{className:y(d.container,!o&&d.hide),children:n.jsx("div",{ref:t,className:d.list,children:V.map(({id:s,link:r,title:a,icon:p})=>{const l=c.includes(r)&&r!=="/"||c===r;return n.jsxs("button",{type:"button",className:y(d.item,l&&d.active),onClick:()=>R(r),children:[n.jsx(p,{className:d.icon}),e(a)]},s)})})})},Q="_popup_1snhx_1",Z="_popupOverlay_1snhx_11",tt="_popupWrap_1snhx_21",et="_popupContent_1snhx_32",nt="_popupClose_1snhx_42",ot="_popupOpen_1snhx_50",m={popup:Q,popupOverlay:Z,popupWrap:tt,popupContent:et,popupClose:nt,popupOpen:ot},st=300,ct=({isOpen:e,children:t,onClose:o})=>{const[c,s]=i.useState(!1);return i.useEffect(()=>{e?(document.body.style.overflow="hidden",s(!0)):(document.body.style.overflow="",setTimeout(()=>s(!1),st))},[e]),c?n.jsxs("div",{className:y(m.popup,e?m.popupOpen:m.popupClose),children:[n.jsx("div",{className:m.popupOverlay,onClick:o}),n.jsx("div",{className:m.popupWrap,children:n.jsx("div",{className:m.popupContent,children:t})})]}):null},rt=document.getElementById("modals"),it=()=>{const e=$(t=>t.popups);return E.createPortal(e.toSorted((t,o)=>t.lastOpen-o.lastOpen).map(({name:t,isOpen:o,close:c,params:s})=>{const r=W[t];return r?n.jsx(ct,{isOpen:o,onClose:()=>s?.overlayClose?c():null,children:n.jsx(r,{close:c,...s})},t):null}),rt)},at=(e,t=300)=>{let o;return(...c)=>{clearTimeout(o),o=setTimeout(()=>e(...c),t)}},N=()=>({width:window.innerWidth,height:window.innerHeight}),ut=()=>{const[e,t]=i.useState(N);return i.useEffect(()=>{const o=at(()=>t(N));return window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o)}},[]),e},pt="_container_1xqeb_1",lt={container:pt},dt=document.getElementById("modals"),mt=()=>{const{width:e,height:t}=ut();return t>e+t/4?null:E.createPortal(n.jsx("div",{className:lt.container,children:n.jsxs("p",{children:["Пожалуйста ",n.jsx("br",{})," поверните устройство"]})}),dt)},f=document.getElementById("root"),x=85,h=20,ft=(e,t)=>{i.useEffect(()=>{if(!t)return;let o=0,c=0,s=0,r=0;function a(u){c=u.touches[0].clientX,o=u.touches[0].clientY,s=0,r=0}function p(u){if(s=u.touches[0].clientX,r=u.touches[0].clientY,e.current){e.current.style.transition="none";const v=s-c-Math.abs(r-o)-h;if(v<h)e.current.style.transform=`translateX(${v}px)`;else{const L=Math.min((v-h)*2,x);e.current.style.transform=`scale(${L/(x*2)+1}) translateX(${h}px)`}}}function l(){if(e.current&&(e.current.style.transition="transform 0.3s",e.current.style.transform="translateX(0) scale(1)"),s===0)return;const u=s-c-Math.abs(r-o)-h;Math.abs(u)>x&&u>0&&t&&t(),c=0,o=0,s=0,r=0}return f.addEventListener("touchstart",a),f.addEventListener("touchmove",p),f.addEventListener("touchend",l),()=>{f.removeEventListener("touchstart",a),f.removeEventListener("touchmove",p),f.removeEventListener("touchend",l)}},[t])},ht="_container_19f8i_1",vt={container:ht},_t=document.getElementById("swipe"),xt=()=>{const e=b(o=>o.swipeRedirectCallback),t=i.useRef(null);return ft(t,e),E.createPortal(n.jsx("div",{className:vt.container,ref:t,children:n.jsx(B,{})}),_t)},yt="_layout_ae4of_1",Et={layout:yt};function gt(){const[e,t]=i.useState(!1),{tgWebAppStartParam:o}=C(),c=I(),{pathname:s}=w();function r({detail:a}){a?.pathname!==s&&a?.pathname&&c(a.pathname==="back-navigate"?-1:a.pathname)}return i.useEffect(()=>{if(o&&!e)try{t(!0);const a=decodeURIComponent(o),{id:p,path:l}=JSON.parse(a);l==="start"&&c(`quiz/${p}`),l==="completed"&&c(`completed/${p}`)}catch{console.log("не удалось распарсить ссылку")}},[o,e,c]),i.useEffect(()=>(document.addEventListener(g,r),()=>{document.removeEventListener(g,r)}),[s]),{pathname:s}}const jt=["ios","android"];function Nt(){const{tgWebAppPlatform:e}=C(),t=jt.includes(e);return i.useLayoutEffect(()=>{_?.isSupported()&&(_?.mount(),_?.disableVertical()),t&&j.requestFullscreen?.isAvailable()&&j.requestFullscreen()},[t]),{isMobile:t}}function It(){const{pathname:e}=gt(),{isMobile:t}=Nt();return n.jsxs(n.Fragment,{children:[n.jsx(M,{}),n.jsx("div",{className:Et.layout,children:n.jsx(P,{})}),n.jsx(A,{}),n.jsx(K,{}),e!=="/"&&n.jsx(xt,{}),t&&e!=="/create"&&n.jsx(mt,{}),n.jsx(it,{})]})}export{It as default};
