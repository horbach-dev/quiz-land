import{r as m,j as s,B as ae,K as qe,A as He,e as Ye,c as D,d as Ne,M as b,f as We}from"./index-UPycLL-e.js";import{c as H,b as E,B as q,a as Oe}from"./Button-B4QhbFUk.js";import{u as ce}from"./useQuery-Dm2FfCmC.js";import{S as Ke}from"./share-DWgTqhcU.js";import{u as le}from"./useMutation-C_jaUH5d.js";import{r as we}from"./index-CEkgxZNq.js";import{P as Ue}from"./page-layout-ujEcNr1G.js";import{u as Ve}from"./popupStore-C5nNLdf-.js";const Ge=[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]],Xe=H("chevrons-left",Ge);const Ze=[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]],De=H("chevrons-right",Ze);const Je=[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]],et=H("flag",Je);const tt=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],je=H("play",tt);const nt=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],st=H("rotate-ccw",nt);const rt=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],ot=H("share-2",rt);function it(e){return ce({queryKey:["getCompletedSession",e],enabled:!1,queryFn:()=>new Promise(n=>{n({})})})}const at="_container_1sw9v_1",ct="_containerLoading_1sw9v_16",lt="_move_1sw9v_1",ut="_image_1sw9v_32",dt="_imageLoaded_1sw9v_41",z={container:at,"container-content":"_container-content_1sw9v_12",containerLoading:ct,move:lt,image:ut,imageLoaded:dt},ue=({image:e,title:n,fit:o="cover",className:l})=>{const[a,d]=m.useState(!0);return s.jsx("div",{className:E(z.container,z[`container-${o}`],a&&z.containerLoading,a&&z.containerLoading,l),children:s.jsx("img",{className:E(z.image,!a&&z.imageLoaded),src:e,alt:n,onLoad:()=>d(!1)})})},mt="_quizCompleted_cg18v_1",ht="_content_cg18v_5",gt="_title_cg18v_9",pt="_poster_cg18v_16",ft="_resultTitle_cg18v_21",_t="_result_cg18v_21",vt="_resultText_cg18v_36",xt="_resultTextResult_cg18v_43",yt="_resultTextCount_cg18v_48",$={quizCompleted:mt,content:ht,title:gt,poster:pt,resultTitle:ft,result:_t,resultText:vt,resultTextResult:xt,resultTextCount:yt},jt="_container_ty462_1",St="_background_ty462_7",kt="_bad_ty462_11",Ct="_middle_ty462_16",bt="_good_ty462_21",Nt="_circle_ty462_26",wt="_fillProgress_ty462_1",G={container:jt,background:St,bad:kt,middle:Ct,good:bt,circle:Nt,fillProgress:wt},Lt=e=>e>=80?"good":e>=50?"middle":"bad",X=188.495,Mt=({percentage:e=0})=>{const n=Math.max(0,Math.min(100,e)),o=X-n/100*X,l=Lt(n);return s.jsx("div",{className:G.container,children:s.jsxs("svg",{className:"progress-ring",width:"100%",height:"100%",viewBox:"0 0 100 100",version:"1.1",style:{"--circumference-value":X,"--offset-value":o},children:[s.jsx("circle",{className:E(G.background),strokeWidth:"5",fill:"transparent",r:"30",cx:"50",cy:"50"}),s.jsx("circle",{className:E(G.circle,G[l]),strokeWidth:"5",fill:"transparent",r:"30",cx:"50",cy:"50",strokeDasharray:X,strokeDashoffset:o,strokeLinecap:"round"})]})})},Et=({quizData:e})=>{const{data:n}=it(e.id),o=()=>{};return n?s.jsxs("div",{className:$.quizCompleted,children:[s.jsxs("div",{className:$.content,children:[s.jsx("p",{className:$.title,children:e.title}),e.poster&&s.jsx(ue,{className:$.poster,image:e?.poster,title:e?.title}),s.jsx("p",{className:$.resultTitle,children:"Ваш результат"}),s.jsxs("div",{className:$.result,children:[s.jsx(Mt,{percentage:(n?.score||0)/n.totalQuestions*100}),s.jsxs("p",{className:$.resultText,children:[s.jsx("span",{className:$.resultTextResult,children:n.score})," / ",s.jsx("span",{className:$.resultTextCount,children:n.totalQuestions})]})]})]}),s.jsx(q,{after:s.jsx(ot,{}),onClick:o,children:"Поделиться результатом"})]}):null},It="_container_yhoit_1",$t="_title_yhoit_7",At="_description_yhoit_13",Tt="_resumeButton_yhoit_19",Pt="_actions_yhoit_23",Rt="_skeletonLine_yhoit_28",Qt="_skeletonActions_yhoit_35",k={container:It,title:$t,description:At,resumeButton:Tt,actions:Pt,skeletonLine:Rt,skeletonActions:Qt},zt=()=>s.jsxs(s.Fragment,{children:[s.jsx("div",{className:E(k.title,k.skeletonLine),children:"Loading..."}),s.jsxs("div",{className:E(k.actions,k.skeletonActions),children:[s.jsx("div",{className:k.skeletonLine}),s.jsx("div",{className:k.skeletonLine})]}),s.jsxs("div",{className:k.description,children:[s.jsx("div",{className:k.skeletonLine}),s.jsx("div",{className:k.skeletonLine}),s.jsx("div",{className:k.skeletonLine}),s.jsx("div",{className:k.skeletonLine}),s.jsx("div",{className:k.skeletonLine})]})]}),Ft=({quizData:e,onStartSession:n,isLoadingStart:o,isLoadingRestart:l})=>{const a=()=>{qe(`${He}?startapp=${e?.id}`,`Пройди тест: ${e?.title}`)},d=o||l,h=e?.poster?ae+e.poster:"";return s.jsxs("div",{className:k.container,children:[s.jsx(ue,{image:h,title:e?.title}),e?s.jsxs(s.Fragment,{children:[s.jsx("p",{className:k.title,children:e?.title}),e?.hasActiveSession&&s.jsx(q,{disabled:d,loading:o,className:k.resumeButton,onClick:()=>n(),after:s.jsx(je,{}),children:"Продолжить"}),s.jsxs("div",{className:k.actions,children:[e?.hasActiveSession?s.jsx(q,{disabled:d,loading:l,onClick:()=>n(!0),after:s.jsx(st,{}),children:"Начать заново"}):s.jsx(q,{disabled:d,loading:o,onClick:()=>n(),after:s.jsx(je,{}),children:"Начать"}),s.jsx(q,{disabled:d,onClick:a,after:s.jsx(Ke,{}),children:"Поделиться"})]}),s.jsx("p",{className:k.description,dangerouslySetInnerHTML:{__html:e?.description||""}})]}):s.jsx(zt,{})]})};function Bt(e){return ce({queryKey:["getQuiz",e],queryFn:()=>Ye(e)})}const qt=async e=>(await D.post("/quiz-session/update-time",e))?.data;function Ht({totalSteps:e,initialStep:n=0,transitionDelay:o=300,onEndReached:l}){const[a,d]=m.useState(n),[h,j]=m.useState(!1),S=m.useCallback(()=>{if(!h){if(a===e-1){l?.();return}j(!0),setTimeout(()=>{j(!1),d(_=>_+1)},o)}},[a,e,h,o,l]),g=m.useCallback(()=>{h||a!==0&&(j(!0),setTimeout(()=>{j(!1),d(_=>_-1)},o))},[a,h,o]);return{step:a,isHide:h,goToNextStep:S,goToPrevStep:g}}const Yt=async e=>(await D.post(`/quiz-session/complete/${e}`))?.data;function Wt(e){const n=Ne(),{mutateAsync:o,isPending:l,isSuccess:a}=le({mutationFn:Yt,onSuccess:d=>{n.setQueryData(["getCompletedSession",e],d),n.invalidateQueries({queryKey:["getQuiz",e]})}});return{completeSession:o,isPending:l,isSuccess:a}}function Ot(e){return ce({queryKey:["getSession",e],enabled:!1,queryFn:()=>new Promise(n=>{n({})})})}const Kt=async e=>(await D.post("/quiz-session/submit-answer",e))?.data;function Ut(){const{mutateAsync:e,isPending:n,error:o,isSuccess:l}=le({mutationFn:Kt});return console.log("error",o),{submitAnswer:e,isPending:n,isSuccess:l}}const Vt=e=>{const n={};return e&&e.forEach(o=>{o.submittedOptionIds&&o.submittedOptionIds.length>0&&(n[o.questionId]=o.submittedOptionIds[0])}),n},Gt=(e,n)=>{const o=e?n.findIndex(l=>l.id===e):0;return o===-1||o===void 0?0:o},Xt="_progressWrap_1xjbf_1",Zt="_progressContainer_1xjbf_38",Dt="_progressCount_1xjbf_45",Jt="_progressIcon_1xjbf_53",en="_progress_1xjbf_1",tn="_progressTrack_1xjbf_67",F={progressWrap:Xt,progressContainer:Zt,progressCount:Dt,progressIcon:Jt,progress:en,progressTrack:tn},nn=document.getElementById("header"),sn=({step:e,timer:n,length:o})=>{const l=m.useRef(null),a=`${(e+1)/o*100}%`;return m.useLayoutEffect(()=>{l?.current?.offsetHeight&&document.documentElement.style.setProperty("--quiz-progress-page-header-height",l.current.offsetHeight+"px")},[]),we.createPortal(s.jsxs("div",{ref:l,className:F.progressWrap,children:[n,s.jsxs("div",{className:F.progressContainer,children:[s.jsxs("div",{className:F.progressCount,children:[e+1," / ",o]}),s.jsx("div",{className:F.progress,children:s.jsx("div",{style:{width:a},className:F.progressTrack})}),s.jsx(et,{className:F.progressIcon})]})]}),nn)},rn="_container_yipxk_1",on="_content_yipxk_17",Se={container:rn,content:on},an="_container_1jn3i_1",cn="_containerImages_1jn3i_8",ln="_item_1jn3i_13",un="_itemActive_1jn3i_30",dn="_itemImage_1jn3i_39",mn="_itemLoading_1jn3i_49",B={container:an,containerImages:cn,item:ln,itemActive:un,itemImage:dn,itemLoading:mn},hn=({isLoading:e,isImage:n,options:o,value:l,onChange:a})=>s.jsx("div",{className:E(B.container,n&&B.containerImages),children:o.map((d,h)=>{const j=l===d.value;return s.jsxs("button",{type:"button",className:E(B.item,j&&B.itemActive,n&&B.itemImage),onClick:()=>a(d.value),children:[n?s.jsx("img",{src:d?.image||"",alt:`image-${h}`}):d.label,e&&j&&s.jsx("span",{className:B.itemLoading})]},d.value)})});function Le(e){let n=b.useRef(e);return b.useEffect(()=>{n.current=e}),b.useMemo(()=>(...o)=>{var l;return(l=n.current)==null?void 0:l.call(n,...o)},[])}function gn({defaultProp:e,onChange:n}){let o=b.useState(e),[l]=o,a=b.useRef(l),d=Le(n);return b.useEffect(()=>{a.current!==l&&(d(l),a.current=l)},[l,a,d]),o}function pn({prop:e,defaultProp:n,onChange:o=()=>{}}){let[l,a]=gn({defaultProp:n,onChange:o}),d=e!==void 0,h=d?e:l,j=Le(o),S=b.useCallback(g=>{if(d){let _=typeof g=="function"?g(e):g;_!==e&&j(_)}else a(g)},[d,e,a,j]);return[h,S]}var ke=.3,fn=30,_n=e=>Math.pow(e-1,3)+1,ie=(e,n,o)=>Math.max(n,Math.min(e,o)),vn=({className:e,children:n})=>b.createElement("div",{className:e,"data-rwp-wrapper":!0},n);function xn({defaultValue:e,value:n,onValueChange:o,options:l,infinite:a=!1,visibleCount:d=20,dragSensitivity:h=3,scrollSensitivity:j=5,optionItemHeight:S=30,classNames:g}){var _;let[A=(_=l[0])==null?void 0:_.value,C]=pn({defaultProp:e,prop:n,onChange:o}),p=m.useMemo(()=>{if(!a)return l;let t=[],r=Math.ceil(d/2);if(l.length===0)return t;for(;t.length<r;)t.push(...l);return t},[d,l,a]),y=S,T=y*.5,v=360/d,P=y/Math.tan(v*Math.PI/180),J=Math.round(P*2+y*.25),M=d>>2,R=h*10,Me=10,N=m.useRef(null),K=m.useRef(null),ee=m.useRef(null),w=m.useRef(0),de=m.useRef(0),Q=m.useRef(!1),me=m.useRef(0),te=m.useRef({startY:0,yList:[],touchScroll:0,isClick:!0}),ne=m.useRef(null),Ee=m.useMemo(()=>{let t=(i,c,u)=>b.createElement("li",{key:c,className:g?.optionItem,"data-slot":"option-item","data-rwp-option":!0,"data-index":c,style:{top:-T,height:y,lineHeight:`${y}px`,transform:`rotateX(${u}deg) translateZ(${P}px)`,visibility:"hidden"}},i.label),r=p.map((i,c)=>t(i,c,-v*c));if(a)for(let i=0;i<M;++i){let c=-i-1,u=i+p.length;r.unshift(t(p[p.length-i-1],c,v*(i+1))),r.push(t(p[i],u,-v*u))}return r},[y,T,a,v,p,M,P,g?.optionItem]),Ie=m.useMemo(()=>{let t=(i,c)=>b.createElement("li",{key:c,className:g?.highlightItem,"data-slot":"highlight-item","data-rwp-highlight-item":!0,style:{height:y}},i.label),r=p.map((i,c)=>t(i,c));if(a){let i=p[0],c=p[p.length-1];r.unshift(t(c,"infinite-start")),r.push(t(i,"infinite-end"))}return r},[g?.highlightItem,y,a,p]),$e=m.useMemo(()=>{let t=0,r=Math.PI/180,i=[];for(let c=M-1;c>=-M+1;--c){let u=c*v,x=y*Math.cos(u*r),f=t;t+=x,i.push([f,t])}return i},[v,y,M]),se=t=>(t%p.length+p.length)%p.length,Y=t=>{let r=a?se(t):t;if(K.current){let i=`translateZ(${-P}px) rotateX(${v*r}deg)`;K.current.style.transform=i,K.current.childNodes.forEach(c=>{let u=c,x=Math.abs(Number(u.dataset.index)-r);u.style.visibility=x>M?"hidden":"visible"})}return ee.current&&(ee.current.style.transform=`translateY(${-r*y}px)`),r},U=()=>{cancelAnimationFrame(de.current)},he=(t,r,i,c)=>{if(t===r||i===0){Y(t);return}let u=performance.now(),x=r-t,f=L=>{let I=(L-u)/1e3;if(I<i){let oe=_n(I/i);w.current=Y(t+oe*x),de.current=requestAnimationFrame(f)}else U(),w.current=Y(r),c?.()};requestAnimationFrame(f)},V=t=>{let r=se(t)|0,i=a?r:Math.min(Math.max(r,0),p.length-1);if(!a&&i!==t)return;w.current=Y(i);let c=p[w.current];C(c.value)},Ae=t=>{let r=p.findIndex(i=>i.value===t);if(r===-1){console.error("Invalid value selected:",t);return}U(),V(r)},ge=t=>{let r=w.current,i=r+t;a?i=Math.round(i):i=ie(Math.round(i),0,p.length-1);let c=Math.abs(i-r);if(c===0)return;let u=Math.sqrt(c/j);U(),he(r,i,u,()=>{V(w.current)})},Te=t=>{let r=N.current;if(!r){console.error("Container reference is not set.");return}let{top:i}=r.getBoundingClientRect(),c=t-i,u=$e.findIndex(([f,L])=>c>=f&&c<=L);if(u===-1){console.error("No item found for click position:",c);return}let x=(M-u-1)*-1;ge(x)},Pe=t=>{var r,i;try{let c=(t instanceof MouseEvent?t.clientY:(i=(r=t.touches)==null?void 0:r[0])==null?void 0:i.clientY)||0,u=te.current;u.isClick&&Math.abs(c-u.startY)>5&&(u.isClick=!1),u.yList.push([c,Date.now()]),u.yList.length>5&&u.yList.shift();let x=(u.startY-c)/y,f=w.current+x;if(a)f=se(f);else{let L=p.length;f<0?f*=ke:f>L&&(f=L+(f-L)*ke)}u.touchScroll=Y(f)}catch(c){console.error("Error in updateScrollDuringDrag:",c)}},pe=t=>{var r;!Q.current&&!((r=N.current)!=null&&r.contains(t.target))&&t.target!==N.current||(t.cancelable&&t.preventDefault(),p.length&&Pe(t))},fe=t=>{var r,i,c;try{Q.current=!0;let u=new AbortController,{signal:x}=u;ne.current=u;let f={signal:x,passive:!1};(r=N.current)==null||r.addEventListener("touchmove",pe,f),document.addEventListener("mousemove",pe,f);let L=(t instanceof MouseEvent?t.clientY:(c=(i=t.touches)==null?void 0:i[0])==null?void 0:c.clientY)||0,I=te.current;I.startY=L,I.yList=[[L,Date.now()]],I.touchScroll=w.current,I.isClick=!0,U()}catch(u){console.error("Error in initiateDragGesture:",u)}},W=m.useCallback(t=>{var r;let i=Q.current,c=!!((r=N.current)!=null&&r.contains(t.target))||t.target===N.current;(i||c)&&t.cancelable&&(t.preventDefault(),p.length&&fe(t))},[fe]),Re=t=>{let r=w.current,i=r,c=t>0?-R:R,u=0;if(a){u=Math.abs(t/c);let x=t*u+.5*c*u*u;i=Math.round(r+x)}else if(r<0||r>p.length-1){let x=ie(r,0,p.length-1),f=r-x;c=Me,u=Math.sqrt(Math.abs(f/c)),t=c*u,t=r>0?-t:t,i=x}else{u=Math.abs(t/c);let x=t*u+.5*c*u*u;i=Math.round(r+x),i=ie(i,0,p.length-1);let f=i-r;u=Math.sqrt(Math.abs(f/c))}he(r,i,u,()=>{V(w.current)}),V(w.current)},_e=()=>{var t,r,i,c;try{(t=ne.current)==null||t.abort(),ne.current=null;let u=te.current;if(u.isClick){Te(u.startY);return}let x=u.yList,f=0;if(x.length>1){let L=x.length,[I,oe]=(r=x[L-2])!=null?r:[0,0],[Qe,ze]=(i=x[L-1])!=null?i:[0,0],xe=ze-oe;if(xe>0){let ye=(I-Qe)/y*1e3/xe,Fe=fn,Be=ye>0?1:-1;f=Math.min(Math.abs(ye),Fe)*Be}}w.current=(c=u.touchScroll)!=null?c:w.current,Re(f)}catch(u){console.error("Error in finalizeDragAndStartInertiaScroll:",u)}finally{Q.current=!1}},O=m.useCallback(t=>{var r;if(!p.length)return;let i=Q.current,c=!!((r=N.current)!=null&&r.contains(t.target))||t.target===N.current;(i||c)&&t.cancelable&&(t.preventDefault(),_e())},[_e]),ve=t=>{t.preventDefault();let r=Date.now();if(r-me.current<100)return;let i=Math.sign(t.deltaY);i&&(me.current=r,ge(i))},re=m.useCallback(t=>{if(!p.length||!N.current)return;let r=Q.current,i=N.current.contains(t.target)||t.target===N.current;(r||i)&&t.cancelable&&(t.preventDefault(),ve(t))},[ve]);return m.useEffect(()=>{let t=N.current;if(!t)return;let r={passive:!1};return t.addEventListener("touchstart",W,r),t.addEventListener("touchend",O,r),t.addEventListener("wheel",re,r),document.addEventListener("mousedown",W,r),document.addEventListener("mouseup",O,r),()=>{t.removeEventListener("touchstart",W),t.removeEventListener("touchend",O),t.removeEventListener("wheel",re),document.removeEventListener("mousedown",W),document.removeEventListener("mouseup",O)}},[O,W,re]),m.useEffect(()=>{Ae(A)},[A,n,p]),b.createElement("div",{ref:N,"data-rwp":!0,style:{height:J}},b.createElement("ul",{ref:K,"data-rwp-options":!0},Ee),b.createElement("div",{className:g?.highlightWrapper,"data-rwp-highlight-wrapper":!0,"data-slot":"highlight-wrapper",style:{height:y,lineHeight:`${y}px`}},b.createElement("ul",{ref:ee,"data-rwp-highlight-list":!0,style:{top:a?-y:void 0}},Ie)))}const yn=window.innerWidth*12/100,jn=({options:e,value:n,onValueChange:o})=>s.jsx(vn,{children:s.jsx(xn,{options:e,optionItemHeight:yn,value:n,onValueChange:o})}),Sn="_container_1soom_1",kn="_title_1soom_11",Cn="_hide_1soom_17",bn="_disabled_1soom_24",Z={container:Sn,title:kn,hide:Cn,disabled:bn},Nn=m.memo(({isHide:e,isLoading:n,question:o,value:l,setValue:a})=>{const d=o.options.map(h=>({image:h.image?ae+h.image:null,label:h.text,value:h.id}));return s.jsxs("div",{className:E(Z.container,e&&Z.hide,n&&Z.disabled),children:[o.image&&s.jsx(ue,{fit:"content",image:ae+o.image,title:o.text},o.id),s.jsx("p",{className:Z.title,children:o.text}),o.type==="MULTI_CHOICE"&&s.jsx(jn,{onValueChange:a,options:d,value:l}),o.type==="SINGLE_CHOICE"&&s.jsx(hn,{isLoading:n,value:l,isImage:!!o.options[0].image,options:d,onChange:a})]})}),wn="_timer_13st3_1",Ln={timer:wn},Mn=({timeSpent:e})=>{const n=e?.current||0,[o,l]=m.useState(n),a=m.useRef(performance.now()-n*1e3),d=m.useRef(null),h=m.useCallback(S=>{const g=S-a.current,_=Math.floor(g/1e3);_!==o&&(e?.current!==void 0&&(e.current=_),l(_)),d.current=requestAnimationFrame(h)},[o]);m.useEffect(()=>(d.current=requestAnimationFrame(h),()=>{d.current&&cancelAnimationFrame(d.current)}),[h]);const j=m.useCallback(S=>{const g=Math.floor(S/3600),_=Math.floor(S%3600/60),A=S%60,C=p=>p.toString().padStart(2,"0");return`${g?`${C(g)}:`:""}${C(_)}:${C(A)}`},[]);return s.jsx("div",{className:Ln.timer,children:j(o)})},En="_container_1cxzz_1",In="_content_1cxzz_45",Ce={container:En,content:In},$n=document.getElementById("footer"),An=({disabled:e,isDone:n,onClick:o})=>we.createPortal(s.jsx("div",{className:Ce.container,children:s.jsx("div",{className:Ce.content,children:s.jsx(q,{onClick:o,disabled:e,before:!n&&s.jsx(Xe,{}),after:n&&s.jsx(De,{}),children:n?"Поделиться":"Назад"})})}),$n);function Tn({quizData:e,setScreen:n}){const{data:o}=Ot(e.id),{submitAnswer:l,isPending:a}=Ut(),{completeSession:d}=Wt(e.id),h=m.useRef(o?.session?.timeSpentSeconds||0),[j,S]=m.useState({}),g=o?.session,_=e.questions,A=Gt(o?.nextQuestionId,_),{step:C,isHide:p,goToNextStep:y,goToPrevStep:T}=Ht({initialStep:A,totalSteps:_.length});m.useEffect(()=>{window.scroll({top:0,behavior:"smooth"})},[C]),m.useEffect(()=>{if(g)return g?.userAnswers?.length&&S(Vt(g.userAnswers)),()=>{qt({sessionId:g.id,seconds:h.current}).catch(M=>{})}},[g]);const v=_[C],P=m.useCallback(M=>{!g?.id||!v.id||(S(R=>({...R,[v.id]:M})),l({sessionId:g.id,questionId:v.id,submittedOptionIds:[M],timeSpentSeconds:h.current}).then(()=>{if(C+1===_.length){d(g.id).then(()=>n("finish"));return}y()}).catch(R=>{console.log("Не удалось отправить ответ",R.message)}))},[C,g?.id,v.id,_.length]);if(!v||!g)return null;const J=j[v.id];return s.jsxs("div",{className:Se.container,children:[s.jsxs("div",{className:Se.content,children:[s.jsx(sn,{step:C,timer:s.jsx(Mn,{timeSpent:h}),length:_.length}),s.jsx(Nn,{isHide:p,isLoading:a,value:J||"",setValue:P,question:v})]}),s.jsx(An,{isDone:!1,disabled:C===0,onClick:T})]})}const Pn=async({id:e,restart:n})=>(await D.post(`/quiz-session/start/${e}`,{restart:n}))?.data;function Rn(e){const[n,o]=m.useState(!1),l=Ne(),{isPending:a,mutateAsync:d}=le({mutationFn:({restart:h})=>Pn({id:e,restart:h}),onMutate:({restart:h})=>o(!!h),onSuccess:h=>{l.setQueryData(["getSession",e],h),l.invalidateQueries({queryKey:["getQuiz",e]})}});return{startSession:d,isLoadingStart:a&&!n,isLoadingRestart:a&&n,isPending:a}}const Qn="_container_7jg9t_1",zn="_containerTransition_7jg9t_6",be={container:Qn,containerTransition:zn},Fn={main:Ft,session:Tn,finish:Et};function Vn(){const e=Oe(v=>v.setSwipeRedirectCallback),n=Ve(v=>v.openPopup),[o,l]=m.useState(!1),[a,d]=m.useState("main"),{id:h}=We(),{data:j,error:S}=Bt(h),{startSession:g,isLoadingStart:_,isLoadingRestart:A}=Rn(h),C=v=>{g({restart:v}).then(()=>y("session"))},p=m.useCallback(()=>{n("sessionEndConfirmation",{onConfirm:()=>d("main")})},[n]),y=v=>{l(!0),setTimeout(()=>{l(!1),d(v)},300)};m.useEffect(()=>{S&&n("quizError",{text:"Похоже такого теста не существует :(",overlayClose:!1})},[S,n]),m.useEffect(()=>(a==="session"?e(p):a==="finish"&&e(()=>d("main")),()=>{e("default")}),[p,a,e]);const T=Fn[a];return s.jsx(Ue,{backCallback:a==="session"?p:void 0,withNavigation:a!=="session",children:s.jsx("div",{className:E(be.container,o&&be.containerTransition),children:s.jsx(T,{quizData:j,onStartSession:C,isLoadingStart:_,isLoadingRestart:A,setScreen:y})})})}export{Vn as default};
