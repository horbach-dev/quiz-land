import{c as L,d as v,e as g,f as j,r as i,j as e,B as u,u as E,P as A,k as N}from"./index-C0sR6Sdv.js";import{u as Q,Q as S,a as R}from"./useQuizListQuery-BNhfFy72.js";import{S as P}from"./SectionHeader-CBEdFdeq.js";import{S as _}from"./square-pen-CmKH08cu.js";import{T as b}from"./trash-2-qdx6wRTE.js";import{u as I,A as $}from"./useUserQuery-BFbve7Up.js";const q=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],B=L("globe",q),H="_container_lkrrv_1",U={container:H},W=async n=>(await v.delete(`/quiz/${n}`))?.data;function D(n){const t=g();return j({mutationFn:()=>W(n),onSuccess:()=>{t.invalidateQueries({queryKey:["getQuizList",{type:"my"}]})}})}function M({onClickOutside:n,ref:t,options:s={}}){i.useEffect(()=>{const o=r=>{const c=s.excludedElementsSelector,a=c&&c.some(p=>!!r.target.closest(p));!t.current||t.current.contains(r.target)||a||n(r)};return document.addEventListener("mousedown",o),document.addEventListener("touchstart",o),()=>{document.removeEventListener("mousedown",o),document.removeEventListener("touchstart",o)}},[s.excludedElementsSelector,t,n])}const F="_popover_vdrbh_1",O="_popoverContent_vdrbh_5",T="_popoverActions_vdrbh_21",x={popover:F,popoverContent:O,popoverActions:T},K=({children:n,text:t,onConfirm:s,onCancel:o})=>{const[r,c]=i.useState(0),a=i.useRef(null),p=i.useRef(null),l=i.useRef(null),[m,f]=i.useState(!1),C=()=>{f(!1),s()},k=()=>{f(!1),o?.()},w=()=>{c(window.innerWidth),f(h=>!h)};return i.useLayoutEffect(()=>{if(p.current&&l.current&&m){const{left:h,width:y}=l.current.getBoundingClientRect(),{width:z}=p.current.getBoundingClientRect();if(l.current.style.bottom="calc(100% + 0.7rem)",r-h-y<20){l.current.style.right="0";return}l.current.style.left=`calc(-${y/2-z/2}px)`}},[m,r]),M({ref:a,onClickOutside:()=>f(!1)}),e.jsxs("div",{ref:a,className:x.popover,children:[m&&e.jsxs("div",{ref:l,className:x.popoverContent,children:[t,e.jsxs("div",{className:x.popoverActions,children:[e.jsx(u,{style:"default",size:"sm",onClick:C,children:"Да"}),e.jsx(u,{style:"white",size:"sm",onClick:k,children:"Нет"})]})]}),e.jsx("div",{onClick:w,ref:p,children:n})]})},G="_cardActions_13057_1",J={cardActions:G},V=({item:n})=>{const{mutate:t,isPending:s}=D(n.id);return e.jsxs("div",{className:J.cardActions,children:[e.jsx(u,{size:"sm",style:"icon",to:`/edit/${n.id}`,children:e.jsx(_,{})}),e.jsx(K,{onConfirm:t,text:e.jsxs(e.Fragment,{children:["Удалить ",e.jsx("br",{})," ",n.title," ?"]}),children:e.jsx(u,{size:"sm",style:"icon",loading:s,type:"button",children:e.jsx(b,{})})})]})},X=async n=>(await v.patch("/user",n)).data;function Y(){const n=g();return j({mutationFn:X,onSuccess:t=>{n.setQueryData(["getUserData"],t)}})}const Z="_profileHeader_ywmlk_1",ee="_profileInfo_ywmlk_7",te="_profileContent_ywmlk_12",ne="_nick_ywmlk_16",se="_line_ywmlk_22",d={profileHeader:Z,profileInfo:ee,profileContent:te,nick:ne,line:se},oe=()=>{const{i18n:n}=E(),{data:t}=I(),{mutateAsync:s,isPending:o}=Y(),r=async()=>{const c=t?.language==="ru"?"en":"ru";s({language:c}).then(a=>{n.changeLanguage(a.language)})};return e.jsxs("div",{className:d.profileHeader,children:[e.jsxs("div",{className:d.profileInfo,children:[e.jsx($,{image:t?.avatar}),e.jsxs("div",{className:d.profileContent,children:[e.jsx("p",{className:d.nick,children:t?.first_name||t?.username}),e.jsx("p",{className:d.line,children:"Создано: 0"}),e.jsx("p",{className:d.line,children:"Пройдено: 0"})]})]}),e.jsx(u,{size:"sm",auto:!0,loading:o,onClick:r,after:e.jsx(B,{}),children:t?.language==="ru"?"RU":"EN"})]})};function ue(){const{isLoading:n,data:t}=Q({type:"my"});return e.jsx(A,{children:e.jsxs("div",{className:U.container,children:[e.jsx(oe,{}),e.jsx(P,{title:"Созданные квизы",actions:e.jsx(u,{size:"sm",to:"/create",after:e.jsx(_,{}),children:"Новый"})}),e.jsx(S,{listKey:"profile-page",isLoading:n,data:t,renderItem:s=>e.jsx(R,{image:N+s.poster,title:s.title,link:`quiz/${s.id}`,actions:e.jsx(V,{item:s})},s.id)})]})})}export{ue as default};
