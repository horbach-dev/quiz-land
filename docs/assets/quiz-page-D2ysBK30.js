import{j as n,r as m,K as Ne,g as we,h as Oe,e as D,f as Le,M as k,u as Ke,i as Ue}from"./index-Dsplwb75.js";import{c as z,a as I,b as K,B as R}from"./buildUrl-DgzsE-QD.js";import{a as ae,u as Ve}from"./useUserQuery-DBVlsOcj.js";import{S as Ge}from"./share-42W-fW9z.js";import{u as ce}from"./useMutation-DewYxahv.js";import{r as $e}from"./index-CCD67qrZ.js";import{P as Xe}from"./page-layout-w5MKi_Ln.js";import{u as Ze}from"./popupStore-FpVJPl1w.js";import"./useBaseQuery-ByNYWybg.js";import"./trash-2-Cy1bG3Ib.js";const Je=[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]],De=z("chevrons-left",Je);const et=[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]],tt=z("chevrons-right",et);const st=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],nt=z("circle-play",st);const rt=[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]],ot=z("flag",rt);const it=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],je=z("play",it);const at=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Me=z("rotate-ccw",at);const ct=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],lt=z("share-2",ct);function ut(e){return ae({queryKey:["getCompletedSession",e],enabled:!1,queryFn:()=>new Promise(t=>{t({})})})}const dt="_description_1fvqi_1",mt={description:dt},Ee=({text:e})=>n.jsx("div",{className:mt.description,dangerouslySetInnerHTML:{__html:e}}),ft="_container_1nkq2_1",ht="_containerLoading_1nkq2_17",gt="_move_1nkq2_1",pt="_image_1nkq2_33",_t="_imageLoaded_1nkq2_42",H={container:ft,"container-content":"_container-content_1nkq2_13",containerLoading:ht,move:gt,image:pt,imageLoaded:_t},le=({image:e,title:t,fit:r="cover",className:c})=>{const[o,u]=m.useState(!0);return n.jsx("div",{className:I(H.container,H[`container-${r}`],o&&H.containerLoading,o&&H.containerLoading,c),children:n.jsx("img",{className:I(H.image,!o&&H.imageLoaded),src:e,alt:t,onLoad:()=>u(!1)})})},xt="_quizCompleted_je4dx_1",vt="_content_je4dx_5",yt="_title_je4dx_9",jt="_poster_je4dx_16",bt="_resultHeader_je4dx_21",kt="_resultInfo_je4dx_27",St="_resultTitle_je4dx_34",Ct="_resultTime_je4dx_39",Nt="_resultProgress_je4dx_48",wt="_resultProgressText_je4dx_55",Lt="_resultTextResult_je4dx_62",$t="_resultTextCount_je4dx_67",Mt="_actions_je4dx_73",$={quizCompleted:xt,content:vt,title:yt,poster:jt,resultHeader:bt,resultInfo:kt,resultTitle:St,resultTime:Ct,resultProgress:Nt,resultProgressText:wt,resultTextResult:Lt,resultTextCount:$t,actions:Mt},Et="_container_ty462_1",It="_background_ty462_7",Tt="_bad_ty462_11",Pt="_middle_ty462_16",At="_good_ty462_21",Rt="_circle_ty462_26",Qt="_fillProgress_ty462_1",X={container:Et,background:It,bad:Tt,middle:Pt,good:At,circle:Rt,fillProgress:Qt},zt=e=>e>=80?"good":e>=50?"middle":"bad",Z=188.495,Ft=({percentage:e=0})=>{const t=Math.max(0,Math.min(100,e)),r=Z-t/100*Z,c=zt(t);return n.jsx("div",{className:X.container,children:n.jsxs("svg",{className:"progress-ring",width:"100%",height:"100%",viewBox:"0 0 100 100",version:"1.1",style:{"--circumference-value":Z,"--offset-value":r},children:[n.jsx("circle",{className:I(X.background),strokeWidth:"5",fill:"transparent",r:"30",cx:"50",cy:"50"}),n.jsx("circle",{className:I(X.circle,X[c]),strokeWidth:"5",fill:"transparent",r:"30",cx:"50",cy:"50",strokeDasharray:Z,strokeDashoffset:r,strokeLinecap:"round"})]})})},Ht=({quizData:e})=>{const{data:t}=ut(e.id),{data:r}=Ve();if(!t)return null;const c=t?.userId===r?.id,o=(t?.score||0)/t.totalQuestions*100,u=e?.resultFeedbacks?.find(x=>o>=Number(x.from)&&o<=Number(x.to)),f=()=>{Ne(`${we}?startapp=${e?.id}/completed`,`Мой результат в тесте: ${e?.title} ${t?.score} из ${t.totalQuestions}`)};return n.jsx("div",{className:$.quizCompleted,children:n.jsxs("div",{className:$.content,children:[n.jsx("p",{className:$.title,children:e.title}),n.jsxs("div",{className:$.resultHeader,children:[e.poster&&n.jsx(le,{className:$.poster,image:K(e.poster),title:e?.title}),n.jsxs("div",{className:$.resultInfo,children:[n.jsx("p",{className:$.resultTitle,children:c?"Ваш результат":"Результат"}),n.jsxs("div",{className:$.resultProgress,children:[n.jsx(Ft,{percentage:o}),n.jsxs("p",{className:$.resultProgressText,children:[n.jsx("span",{className:$.resultTextResult,children:t.score})," / ",n.jsx("span",{className:$.resultTextCount,children:t.totalQuestions})]})]}),n.jsxs("p",{className:$.resultTime,children:["Время: ",n.jsx("span",{children:"1 ч. 25 мин."})]})]})]}),c?n.jsxs("div",{className:$.actions,children:[n.jsx(R,{to:`/quiz/${e.id}`,after:n.jsx(Me,{}),children:"Повторить"}),n.jsx(R,{after:n.jsx(lt,{}),onClick:f,children:"Поделиться результатом"})]}):n.jsx(R,{to:`/quiz/${e.id}`,after:n.jsx(nt,{}),children:"Пройти тест"}),u&&n.jsx(Ee,{text:u.text})]})})},qt="_container_1f8b7_1",Bt="_title_1f8b7_7",Yt="_description_1f8b7_13",Wt="_resumeButton_1f8b7_20",Ot="_actions_1f8b7_24",Kt="_skeletonLine_1f8b7_30",Ut="_skeletonActions_1f8b7_37",b={container:qt,title:Bt,description:Yt,resumeButton:Wt,actions:Ot,skeletonLine:Kt,skeletonActions:Ut},Vt=()=>n.jsxs(n.Fragment,{children:[n.jsx("div",{className:I(b.title,b.skeletonLine),children:"Loading..."}),n.jsxs("div",{className:I(b.actions,b.skeletonActions),children:[n.jsx("div",{className:b.skeletonLine}),n.jsx("div",{className:b.skeletonLine})]}),n.jsxs("div",{className:b.description,children:[n.jsx("div",{className:b.skeletonLine}),n.jsx("div",{className:b.skeletonLine}),n.jsx("div",{className:b.skeletonLine}),n.jsx("div",{className:b.skeletonLine}),n.jsx("div",{className:b.skeletonLine})]})]}),Gt=({quizData:e,onStartSession:t,isLoadingStart:r,isLoadingRestart:c})=>{const o=()=>{Ne(`${we}?startapp=${e?.id}/start`,`Пройди тест: ${e?.title}`)},u=r||c,f=e?.poster?K(e.poster):void 0;return n.jsxs("div",{className:b.container,children:[n.jsx(le,{image:f,title:e?.title}),e?n.jsxs(n.Fragment,{children:[n.jsx("p",{className:b.title,children:e?.title}),e?.hasActiveSession&&n.jsx(R,{disabled:u,loading:r,className:b.resumeButton,onClick:()=>t(),after:n.jsx(je,{}),children:"Продолжить"}),n.jsxs("div",{className:b.actions,children:[e?.hasActiveSession?n.jsx(R,{disabled:u,loading:c,onClick:()=>t(!0),after:n.jsx(Me,{}),children:"Начать заново"}):n.jsx(R,{disabled:u,loading:r,onClick:()=>t(),after:n.jsx(je,{}),children:"Начать"}),n.jsx(R,{disabled:u,onClick:o,after:n.jsx(Ge,{}),children:"Поделиться"})]}),e?.description&&n.jsx(Ee,{text:e?.description})]}):n.jsx(Vt,{})]})};function Xt(e){return ae({queryKey:["getQuiz",e],queryFn:()=>Oe(e)})}const Zt=e=>{const t={};return e&&e.forEach(r=>{r.submittedOptionIds&&r.submittedOptionIds.length>0&&(t[r.questionId]=r.submittedOptionIds[0])}),t},Jt=(e,t)=>{const r=t?e.findIndex(c=>c.id===t):0;return r===-1||r===void 0?0:r},Dt=async e=>(await D.post(`/quiz-session/complete/${e}`))?.data;function es(e){const t=Le(),{mutateAsync:r,isPending:c,isSuccess:o}=ce({mutationFn:Dt,onSuccess:u=>{t.setQueryData(["getCompletedSession",e],u),t.invalidateQueries({queryKey:["getQuiz",e]})}});return{completeSession:r,isPending:c,isSuccess:o}}const ts=async e=>(await D.post("/quiz-session/submit-answer",e))?.data;function ss(){const{mutateAsync:e,isPending:t,isSuccess:r}=ce({mutationFn:ts});return{submitAnswer:e,isPending:t,isSuccess:r}}function ns({session:e,quizId:t,timeSpentSeconds:r,questionsLength:c,setScreen:o}){const[u,f]=m.useState({}),{submitAnswer:x,isPending:j}=ss(),{completeSession:g}=es(t);m.useEffect(()=>{e?.userAnswers?.length&&f(Zt(e.userAnswers))},[e]);const v=m.useCallback(async({step:E,questionId:S,value:h,goToNextStep:p})=>{if(!(!e.id||!S||j)){f(M=>({...M,[S]:h}));try{await x({sessionId:e.id,questionId:S,timeSpentSeconds:r,submittedOptionIds:[h]}),E+1===c?(await g(e.id),o("finish")):p()}catch(M){console.log("Не удалось отправить ответ",M.message)}}},[e.id,j,r,c]);return{answers:u,isPending:j,submit:v}}const rs=async e=>(await D.post("/quiz-session/update-time",e))?.data;function os(e,t=0){const r=m.useRef(t);return m.useEffect(()=>{if(e)return()=>{e&&rs({sessionId:e,seconds:r.current}).catch(()=>{})}},[e]),{timeSpent:r}}function is({totalSteps:e,initialStep:t=0,transitionDelay:r=300,onEndReached:c}){const[o,u]=m.useState(t),[f,x]=m.useState(!1);m.useEffect(()=>{window.scroll({top:0,behavior:"smooth"})},[o]);const j=m.useCallback(()=>{if(!f){if(o===e-1){c?.();return}x(!0),setTimeout(()=>{x(!1),u(v=>v+1)},r)}},[o,e,f,r,c]),g=m.useCallback(()=>{f||o!==0&&(x(!0),setTimeout(()=>{x(!1),u(v=>v-1)},r))},[o,f,r]);return{step:o,isHide:f,goToNextStep:j,goToPrevStep:g}}function as(e){return ae({queryKey:["getSession",e],enabled:!1,queryFn:()=>new Promise(t=>{t({})})})}const cs="_progressWrap_1xjbf_1",ls="_progressContainer_1xjbf_38",us="_progressCount_1xjbf_45",ds="_progressIcon_1xjbf_53",ms="_progress_1xjbf_1",fs="_progressTrack_1xjbf_67",q={progressWrap:cs,progressContainer:ls,progressCount:us,progressIcon:ds,progress:ms,progressTrack:fs},hs=document.getElementById("header"),gs=({step:e,timer:t,length:r})=>{const c=m.useRef(null),o=`${(e+1)/r*100}%`;return m.useLayoutEffect(()=>{c?.current?.offsetHeight&&document.documentElement.style.setProperty("--quiz-progress-page-header-height",c.current.offsetHeight+"px")},[]),$e.createPortal(n.jsxs("div",{ref:c,className:q.progressWrap,children:[t,n.jsxs("div",{className:q.progressContainer,children:[n.jsxs("div",{className:q.progressCount,children:[e+1," / ",r]}),n.jsx("div",{className:q.progress,children:n.jsx("div",{style:{width:o},className:q.progressTrack})}),n.jsx(ot,{className:q.progressIcon})]})]}),hs)},ps="_container_yipxk_1",_s="_content_yipxk_17",be={container:ps,content:_s},xs="_container_wvzbi_1",vs="_containerImages_wvzbi_8",ys="_item_wvzbi_13",js="_itemActive_wvzbi_29",bs="_itemImage_wvzbi_38",ks="_itemLoading_wvzbi_50",B={container:xs,containerImages:vs,item:ys,itemActive:js,itemImage:bs,itemLoading:ks},Ss=({isLoading:e,isImage:t,options:r,value:c,onChange:o})=>n.jsx("div",{className:I(B.container,t&&B.containerImages),children:r.map((u,f)=>{const x=c===u.value;return n.jsxs("button",{type:"button",className:I(B.item,x&&B.itemActive,t&&B.itemImage),onClick:()=>o(u.value),children:[t?n.jsx("img",{src:u?.image||"",alt:`image-${f}`}):u.label,e&&x&&n.jsx("span",{className:B.itemLoading})]},u.value)})});function Ie(e){let t=k.useRef(e);return k.useEffect(()=>{t.current=e}),k.useMemo(()=>(...r)=>{var c;return(c=t.current)==null?void 0:c.call(t,...r)},[])}function Cs({defaultProp:e,onChange:t}){let r=k.useState(e),[c]=r,o=k.useRef(c),u=Ie(t);return k.useEffect(()=>{o.current!==c&&(u(c),o.current=c)},[c,o,u]),r}function Ns({prop:e,defaultProp:t,onChange:r=()=>{}}){let[c,o]=Cs({defaultProp:t,onChange:r}),u=e!==void 0,f=u?e:c,x=Ie(r),j=k.useCallback(g=>{if(u){let v=typeof g=="function"?g(e):g;v!==e&&x(v)}else o(g)},[u,e,o,x]);return[f,j]}var ke=.3,ws=30,Ls=e=>Math.pow(e-1,3)+1,ie=(e,t,r)=>Math.max(t,Math.min(e,r)),$s=({className:e,children:t})=>k.createElement("div",{className:e,"data-rwp-wrapper":!0},t);function Ms({defaultValue:e,value:t,onValueChange:r,options:c,infinite:o=!1,visibleCount:u=20,dragSensitivity:f=3,scrollSensitivity:x=5,optionItemHeight:j=30,classNames:g}){var v;let[E=(v=c[0])==null?void 0:v.value,S]=Ns({defaultProp:e,prop:t,onChange:r}),h=m.useMemo(()=>{if(!o)return c;let s=[],i=Math.ceil(u/2);if(c.length===0)return s;for(;s.length<i;)s.push(...c);return s},[u,c,o]),p=j,M=p*.5,C=360/u,A=p/Math.tan(C*Math.PI/180),T=Math.round(A*2+p*.25),Q=u>>2,ue=f*10,Te=10,N=m.useRef(null),U=m.useRef(null),ee=m.useRef(null),w=m.useRef(0),de=m.useRef(0),F=m.useRef(!1),me=m.useRef(0),te=m.useRef({startY:0,yList:[],touchScroll:0,isClick:!0}),se=m.useRef(null),Pe=m.useMemo(()=>{let s=(a,l,d)=>k.createElement("li",{key:l,className:g?.optionItem,"data-slot":"option-item","data-rwp-option":!0,"data-index":l,style:{top:-M,height:p,lineHeight:`${p}px`,transform:`rotateX(${d}deg) translateZ(${A}px)`,visibility:"hidden"}},a.label),i=h.map((a,l)=>s(a,l,-C*l));if(o)for(let a=0;a<Q;++a){let l=-a-1,d=a+h.length;i.unshift(s(h[h.length-a-1],l,C*(a+1))),i.push(s(h[a],d,-C*d))}return i},[p,M,o,C,h,Q,A,g?.optionItem]),Ae=m.useMemo(()=>{let s=(a,l)=>k.createElement("li",{key:l,className:g?.highlightItem,"data-slot":"highlight-item","data-rwp-highlight-item":!0,style:{height:p}},a.label),i=h.map((a,l)=>s(a,l));if(o){let a=h[0],l=h[h.length-1];i.unshift(s(l,"infinite-start")),i.push(s(a,"infinite-end"))}return i},[g?.highlightItem,p,o,h]),Re=m.useMemo(()=>{let s=0,i=Math.PI/180,a=[];for(let l=Q-1;l>=-Q+1;--l){let d=l*C,y=p*Math.cos(d*i),_=s;s+=y,a.push([_,s])}return a},[C,p,Q]),ne=s=>(s%h.length+h.length)%h.length,Y=s=>{let i=o?ne(s):s;if(U.current){let a=`translateZ(${-A}px) rotateX(${C*i}deg)`;U.current.style.transform=a,U.current.childNodes.forEach(l=>{let d=l,y=Math.abs(Number(d.dataset.index)-i);d.style.visibility=y>Q?"hidden":"visible"})}return ee.current&&(ee.current.style.transform=`translateY(${-i*p}px)`),i},V=()=>{cancelAnimationFrame(de.current)},fe=(s,i,a,l)=>{if(s===i||a===0){Y(s);return}let d=performance.now(),y=i-s,_=L=>{let P=(L-d)/1e3;if(P<a){let oe=Ls(P/a);w.current=Y(s+oe*y),de.current=requestAnimationFrame(_)}else V(),w.current=Y(i),l?.()};requestAnimationFrame(_)},G=s=>{let i=ne(s)|0,a=o?i:Math.min(Math.max(i,0),h.length-1);if(!o&&a!==s)return;w.current=Y(a);let l=h[w.current];S(l.value)},Qe=s=>{let i=h.findIndex(a=>a.value===s);if(i===-1){console.error("Invalid value selected:",s);return}V(),G(i)},he=s=>{let i=w.current,a=i+s;o?a=Math.round(a):a=ie(Math.round(a),0,h.length-1);let l=Math.abs(a-i);if(l===0)return;let d=Math.sqrt(l/x);V(),fe(i,a,d,()=>{G(w.current)})},ze=s=>{let i=N.current;if(!i){console.error("Container reference is not set.");return}let{top:a}=i.getBoundingClientRect(),l=s-a,d=Re.findIndex(([_,L])=>l>=_&&l<=L);if(d===-1){console.error("No item found for click position:",l);return}let y=(Q-d-1)*-1;he(y)},Fe=s=>{var i,a;try{let l=(s instanceof MouseEvent?s.clientY:(a=(i=s.touches)==null?void 0:i[0])==null?void 0:a.clientY)||0,d=te.current;d.isClick&&Math.abs(l-d.startY)>5&&(d.isClick=!1),d.yList.push([l,Date.now()]),d.yList.length>5&&d.yList.shift();let y=(d.startY-l)/p,_=w.current+y;if(o)_=ne(_);else{let L=h.length;_<0?_*=ke:_>L&&(_=L+(_-L)*ke)}d.touchScroll=Y(_)}catch(l){console.error("Error in updateScrollDuringDrag:",l)}},ge=s=>{var i;!F.current&&!((i=N.current)!=null&&i.contains(s.target))&&s.target!==N.current||(s.cancelable&&s.preventDefault(),h.length&&Fe(s))},pe=s=>{var i,a,l;try{F.current=!0;let d=new AbortController,{signal:y}=d;se.current=d;let _={signal:y,passive:!1};(i=N.current)==null||i.addEventListener("touchmove",ge,_),document.addEventListener("mousemove",ge,_);let L=(s instanceof MouseEvent?s.clientY:(l=(a=s.touches)==null?void 0:a[0])==null?void 0:l.clientY)||0,P=te.current;P.startY=L,P.yList=[[L,Date.now()]],P.touchScroll=w.current,P.isClick=!0,V()}catch(d){console.error("Error in initiateDragGesture:",d)}},W=m.useCallback(s=>{var i;let a=F.current,l=!!((i=N.current)!=null&&i.contains(s.target))||s.target===N.current;(a||l)&&s.cancelable&&(s.preventDefault(),h.length&&pe(s))},[pe]),He=s=>{let i=w.current,a=i,l=s>0?-ue:ue,d=0;if(o){d=Math.abs(s/l);let y=s*d+.5*l*d*d;a=Math.round(i+y)}else if(i<0||i>h.length-1){let y=ie(i,0,h.length-1),_=i-y;l=Te,d=Math.sqrt(Math.abs(_/l)),s=l*d,s=i>0?-s:s,a=y}else{d=Math.abs(s/l);let y=s*d+.5*l*d*d;a=Math.round(i+y),a=ie(a,0,h.length-1);let _=a-i;d=Math.sqrt(Math.abs(_/l))}fe(i,a,d,()=>{G(w.current)}),G(w.current)},_e=()=>{var s,i,a,l;try{(s=se.current)==null||s.abort(),se.current=null;let d=te.current;if(d.isClick){ze(d.startY);return}let y=d.yList,_=0;if(y.length>1){let L=y.length,[P,oe]=(i=y[L-2])!=null?i:[0,0],[qe,Be]=(a=y[L-1])!=null?a:[0,0],ve=Be-oe;if(ve>0){let ye=(P-qe)/p*1e3/ve,Ye=ws,We=ye>0?1:-1;_=Math.min(Math.abs(ye),Ye)*We}}w.current=(l=d.touchScroll)!=null?l:w.current,He(_)}catch(d){console.error("Error in finalizeDragAndStartInertiaScroll:",d)}finally{F.current=!1}},O=m.useCallback(s=>{var i;if(!h.length)return;let a=F.current,l=!!((i=N.current)!=null&&i.contains(s.target))||s.target===N.current;(a||l)&&s.cancelable&&(s.preventDefault(),_e())},[_e]),xe=s=>{s.preventDefault();let i=Date.now();if(i-me.current<100)return;let a=Math.sign(s.deltaY);a&&(me.current=i,he(a))},re=m.useCallback(s=>{if(!h.length||!N.current)return;let i=F.current,a=N.current.contains(s.target)||s.target===N.current;(i||a)&&s.cancelable&&(s.preventDefault(),xe(s))},[xe]);return m.useEffect(()=>{let s=N.current;if(!s)return;let i={passive:!1};return s.addEventListener("touchstart",W,i),s.addEventListener("touchend",O,i),s.addEventListener("wheel",re,i),document.addEventListener("mousedown",W,i),document.addEventListener("mouseup",O,i),()=>{s.removeEventListener("touchstart",W),s.removeEventListener("touchend",O),s.removeEventListener("wheel",re),document.removeEventListener("mousedown",W),document.removeEventListener("mouseup",O)}},[O,W,re]),m.useEffect(()=>{Qe(E)},[E,t,h]),k.createElement("div",{ref:N,"data-rwp":!0,style:{height:T}},k.createElement("ul",{ref:U,"data-rwp-options":!0},Pe),k.createElement("div",{className:g?.highlightWrapper,"data-rwp-highlight-wrapper":!0,"data-slot":"highlight-wrapper",style:{height:p,lineHeight:`${p}px`}},k.createElement("ul",{ref:ee,"data-rwp-highlight-list":!0,style:{top:o?-p:void 0}},Ae)))}const Es=window.innerWidth*12/100,Is=({options:e,value:t,onValueChange:r})=>n.jsx($s,{children:n.jsx(Ms,{options:e,optionItemHeight:Es,value:t,onValueChange:r})}),Ts="_container_1soom_1",Ps="_title_1soom_11",As="_hide_1soom_17",Rs="_disabled_1soom_24",J={container:Ts,title:Ps,hide:As,disabled:Rs},Qs=m.memo(({isHide:e,isLoading:t,question:r,value:c,setValue:o})=>{const u=r.options.map(f=>({image:f.image?K(f.image):null,label:f.text,value:f.id}));return n.jsxs("div",{className:I(J.container,e&&J.hide,t&&J.disabled),children:[r.image&&n.jsx(le,{fit:"content",image:K(r.image),title:r.text},r.id),n.jsx("p",{className:J.title,children:r.text}),r.type==="MULTI_CHOICE"&&n.jsx(Is,{onValueChange:o,options:u,value:c}),r.type==="SINGLE_CHOICE"&&n.jsx(Ss,{isLoading:t,value:c,isImage:!!r.options[0].image,options:u,onChange:o})]})}),zs="_timer_13st3_1",Fs={timer:zs},Hs=({timeSpent:e})=>{const t=e?.current||0,[r,c]=m.useState(t),o=m.useRef(performance.now()-t*1e3),u=m.useRef(null),f=m.useCallback(j=>{const g=j-o.current,v=Math.floor(g/1e3);v!==r&&(e?.current!==void 0&&(e.current=v),c(v)),u.current=requestAnimationFrame(f)},[r]);m.useEffect(()=>(u.current=requestAnimationFrame(f),()=>{u.current&&cancelAnimationFrame(u.current)}),[f]);const x=m.useCallback(j=>{const g=Math.floor(j/3600),v=Math.floor(j%3600/60),E=j%60,S=h=>h.toString().padStart(2,"0");return`${g?`${S(g)}:`:""}${S(v)}:${S(E)}`},[]);return n.jsx("div",{className:Fs.timer,children:x(r)})},qs="_container_1cxzz_1",Bs="_content_1cxzz_45",Se={container:qs,content:Bs},Ys=document.getElementById("footer"),Ws=({disabled:e,isDone:t,onClick:r})=>$e.createPortal(n.jsx("div",{className:Se.container,children:n.jsx("div",{className:Se.content,children:n.jsx(R,{onClick:r,disabled:e,before:!t&&n.jsx(De,{}),after:t&&n.jsx(tt,{}),children:t?"Поделиться":"Назад"})})}),Ys);function Os({quizData:e,setScreen:t}){const{data:r}=as(e.id),c=r?.session,o=e.questions,u=m.useMemo(()=>Jt(o,r?.nextQuestionId),[o,r?.nextQuestionId]),{step:f,isHide:x,goToNextStep:j,goToPrevStep:g}=is({initialStep:u,totalSteps:o.length}),{timeSpent:v}=os(c?.id,r?.session?.timeSpentSeconds),{answers:E,submit:S,isPending:h}=ns({session:c,quizId:e.id,setScreen:t,questionsLength:o.length,timeSpentSeconds:v.current}),p=o[f],M=A=>S({questionId:p.id,value:A,step:f,goToNextStep:j});if(!p||!c)return null;const C=E[p.id];return n.jsxs("div",{className:be.container,children:[n.jsxs("div",{className:be.content,children:[n.jsx(gs,{step:f,timer:n.jsx(Hs,{timeSpent:v}),length:o.length}),n.jsx(Qs,{isHide:x,isLoading:h,value:C||"",setValue:M,question:p})]}),n.jsx(Ws,{isDone:!1,disabled:f===0,onClick:g})]})}const Ks=async({id:e,restart:t})=>(await D.post(`/quiz-session/start/${e}`,{restart:t}))?.data;function Us(e){const[t,r]=m.useState(!1),c=Le(),{isPending:o,mutateAsync:u}=ce({mutationFn:({restart:f})=>Ks({id:e,restart:f}),onMutate:({restart:f})=>r(!!f),onSuccess:f=>{c.setQueryData(["getSession",e],f),c.invalidateQueries({queryKey:["getQuiz",e]})}});return{startSession:u,isLoadingStart:o&&!t,isLoadingRestart:o&&t,isPending:o}}const Vs="_container_7jg9t_1",Gs="_containerTransition_7jg9t_6",Ce={container:Vs,containerTransition:Gs};function Xs(e,t){let r=0,c=0;const o=e.length;e.forEach(function(u){const f=new Image;f.onload=()=>{r++,r+c===o&&t()},f.onerror=()=>{c++,r+c===o&&t()},f.src=K(u)})}function Zs(e,t){const r=[];e?.questions&&e?.questions.forEach(c=>{c?.image&&r.push(c.image),c.options.forEach(o=>{o?.image&&r.push(o.image)})}),Xs(r,t)}const Js={main:Gt,session:Os,finish:Ht};function un(){const e=Ke(T=>T.setSwipeRedirectCallback),t=Ze(T=>T.openPopup),[r,c]=m.useState(!1),[o,u]=m.useState("main"),[f,x]=m.useState(!1),{id:j}=Ue(),{data:g,error:v}=Xt(j),{startSession:E,isLoadingStart:S,isLoadingRestart:h}=Us(j),p=T=>{g&&(x(!0),Zs(g,()=>{x(!1),E({restart:T}).then(()=>C("session"))}))},M=m.useCallback(()=>{t("sessionEndConfirmation",{onConfirm:()=>u("main")})},[t]),C=T=>{c(!0),setTimeout(()=>{c(!1),u(T)},300)};m.useEffect(()=>{v&&t("quizError",{text:"Похоже такого теста не существует :(",overlayClose:!1})},[v,t]),m.useEffect(()=>(o==="session"?e(M):o==="finish"&&e(()=>u("main")),()=>{e("default")}),[M,o,e]);const A=Js[o];return n.jsx(Xe,{backCallback:o==="session"?M:void 0,withNavigation:o!=="session",children:n.jsx("div",{className:I(Ce.container,r&&Ce.containerTransition),children:n.jsx(A,{quizData:g,onStartSession:p,isLoadingStart:S||f,isLoadingRestart:h||f,setScreen:C})})})}export{un as default};
