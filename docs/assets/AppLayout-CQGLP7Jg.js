import{r as a,J as k,c as S,H as O,u as b,a as w,j as s,b as y,n as A,d as P,C as g,e as _,m as j,O as R,S as I}from"./index-rDwIdqWj.js";import{C as T}from"./circle-check-big-DWVdA9l6.js";import{u as z}from"./useTranslation-BbnBv4qd.js";import{r as E}from"./index-gusptJ4P.js";import{u as $,r as W}from"./popupStore-CpRufNik.js";import{B as M}from"./Background-DYaJZ7x3.js";import"./buildUrl-BKAySUEN.js";import"./trash-2-CiGuZiO4.js";function C(e){return a.useMemo(()=>k(),[e])}const X=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],B=S("chevron-left",X);const H=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],q=S("user",H),V=[{id:1,title:"navigation.main",icon:O,link:"/"},{id:2,title:"navigation.quizzes",icon:T,link:"/quizzes"},{id:3,title:"navigation.profile",icon:q,link:"/profile"}],Y="_container_kfp16_1",F="_list_kfp16_16",G="_hide_kfp16_51",J="_item_kfp16_55",D="_active_kfp16_84",U="_icon_kfp16_88",l={container:Y,list:F,hide:G,item:J,active:D,icon:U},K=()=>{const{t:e}=z(),t=a.useRef(null),n=b(o=>o.isNavigationVisible),{pathname:r}=w();return a.useLayoutEffect(()=>{t?.current?.offsetHeight&&document.documentElement.style.setProperty("--navigation-height",t.current.offsetHeight+"px")},[]),s.jsx("div",{className:y(l.container,!n&&l.hide),children:s.jsx("div",{ref:t,className:l.list,children:V.map(({id:o,link:c,title:i,icon:u})=>{const h=r.includes(c)&&c!=="/"||r===c;return s.jsxs("button",{type:"button",className:y(l.item,h&&l.active),onClick:()=>A(c),children:[s.jsx(u,{className:l.icon}),e(i)]},o)})})})},Q="_popup_1snhx_1",Z="_popupOverlay_1snhx_11",tt="_popupWrap_1snhx_21",et="_popupContent_1snhx_32",nt="_popupClose_1snhx_42",st="_popupOpen_1snhx_50",d={popup:Q,popupOverlay:Z,popupWrap:tt,popupContent:et,popupClose:nt,popupOpen:st},ot=300,rt=({isOpen:e,children:t,onClose:n})=>{const[r,o]=a.useState(!1);return a.useEffect(()=>{e?(document.body.style.overflow="hidden",o(!0)):(document.body.style.overflow="",setTimeout(()=>o(!1),ot))},[e]),r?s.jsxs("div",{className:y(d.popup,e?d.popupOpen:d.popupClose),children:[s.jsx("div",{className:d.popupOverlay,onClick:n}),s.jsx("div",{className:d.popupWrap,children:s.jsx("div",{className:d.popupContent,children:t})})]}):null},ct=document.getElementById("modals"),it=()=>{const e=$(t=>t.popups);return E.createPortal(e.toSorted((t,n)=>t.lastOpen-n.lastOpen).map(({name:t,isOpen:n,close:r,params:o})=>{const c=W[t];return c?s.jsx(rt,{isOpen:n,onClose:()=>o?.overlayClose?r():null,children:s.jsx(c,{close:r,...o})},t):null}),ct)},at=(e,t=300)=>{let n;return(...r)=>{clearTimeout(n),n=setTimeout(()=>e(...r),t)}},N=()=>({width:window.innerWidth,height:window.innerHeight}),ut=()=>{const[e,t]=a.useState(N);return a.useEffect(()=>{const n=at(()=>t(N));return window.addEventListener("resize",n),()=>{window.removeEventListener("resize",n)}},[]),e},pt="_container_1xqeb_1",lt={container:pt},dt=document.getElementById("modals"),mt=()=>{const{width:e,height:t}=ut();return t>e+t/4?null:E.createPortal(s.jsx("div",{className:lt.container,children:s.jsxs("p",{children:["Пожалуйста ",s.jsx("br",{})," поверните устройство"]})}),dt)},m=document.getElementById("root"),x=85,f=20,ft=(e,t)=>{a.useEffect(()=>{if(!t)return;let n=0,r=0,o=0,c=0;function i(p){r=p.touches[0].clientX,n=p.touches[0].clientY,o=0,c=0}function u(p){if(o=p.touches[0].clientX,c=p.touches[0].clientY,e.current){e.current.style.transition="none";const v=o-r-Math.abs(c-n)-f;if(v<f)e.current.style.transform=`translateX(${v}px)`;else{const L=Math.min((v-f)*2,x);e.current.style.transform=`scale(${L/(x*2)+1}) translateX(${f}px)`}}}function h(){if(e.current&&(e.current.style.transition="transform 0.3s",e.current.style.transform="translateX(0) scale(1)"),o===0)return;const p=o-r-Math.abs(c-n)-f;Math.abs(p)>x&&p>0&&t&&t(),r=0,n=0,o=0,c=0}return m.addEventListener("touchstart",i),m.addEventListener("touchmove",u),m.addEventListener("touchend",h),()=>{m.removeEventListener("touchstart",i),m.removeEventListener("touchmove",u),m.removeEventListener("touchend",h)}},[t])},ht="_container_19f8i_1",vt={container:ht},_t=document.getElementById("swipe"),xt=()=>{const e=b(n=>n.swipeRedirectCallback),t=a.useRef(null);return ft(t,e),E.createPortal(s.jsx("div",{className:vt.container,ref:t,children:s.jsx(B,{})}),_t)},yt="_layout_ae4of_1",Et={layout:yt};function gt(){const[e,t]=a.useState(!1),{tgWebAppStartParam:n}=C(),r=P(),{pathname:o}=w();function c({detail:i}){i?.pathname!==o&&i?.pathname&&r(i.pathname==="back-navigate"?-1:i.pathname)}return a.useEffect(()=>{if(n&&!e){t(!0);const[i,u]=n.replaceAll('"',"").split("&&");alert(JSON.stringify({id:i,path:u,tgWebAppStartParam:n})),u==="start"&&r(`quiz/${i}`),u==="completed"&&r(`completed/${i}`)}},[n,e,r]),a.useEffect(()=>(document.addEventListener(g,c),()=>{document.removeEventListener(g,c)}),[o]),{pathname:o}}const jt=["ios","android"];function Nt(){const{tgWebAppPlatform:e}=C(),t=jt.includes(e);return a.useLayoutEffect(()=>{_?.isSupported()&&(_?.mount(),_?.disableVertical()),t&&j.requestFullscreen?.isAvailable()&&j.requestFullscreen()},[t]),{isMobile:t}}function Pt(){const{pathname:e}=gt(),{isMobile:t}=Nt();return s.jsxs(s.Fragment,{children:[s.jsx(M,{}),s.jsx("div",{className:Et.layout,children:s.jsx(R,{})}),s.jsx(I,{}),s.jsx(K,{}),e!=="/"&&s.jsx(xt,{}),t&&e!=="/create"&&s.jsx(mt,{}),s.jsx(it,{})]})}export{Pt as default};
