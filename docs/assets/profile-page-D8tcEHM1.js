import{d as v,e as y,r as i,j as e}from"./index-BViiGnCv.js";import{Q as E,a as N}from"./QuizList-DqcASGJz.js";import{P as A,b as L}from"./page-layout-6nSppNve.js";import{c as S,B as d,u as Q}from"./Button-uA8O_c__.js";import{S as b}from"./SectionHeader-AcCeqSvE.js";import{u as g}from"./useMutation-CGdvt3ok.js";import{S as _}from"./square-pen-MXviL3Il.js";import{T as R}from"./trash-2-3nzqdXQT.js";import{u as P,A as I}from"./useUserQuery-8IpSes9i.js";import"./useBaseQuery-Cn-GaRnJ.js";import"./useQuery-BHPkRtKW.js";const $=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],q=S("globe",$),H="_container_lkrrv_1",U={container:H},W=async t=>(await v.delete(`/quiz/${t}`))?.data;function B(t){const n=y();return g({mutationFn:()=>W(t),onSuccess:()=>{n.invalidateQueries({queryKey:["getQuizList",{type:"my"}]})}})}function D({onClickOutside:t,ref:n,options:s={}}){i.useEffect(()=>{const o=r=>{const c=s.excludedElementsSelector,a=c&&c.some(p=>!!r.target.closest(p));!n.current||n.current.contains(r.target)||a||t(r)};return document.addEventListener("mousedown",o),document.addEventListener("touchstart",o),()=>{document.removeEventListener("mousedown",o),document.removeEventListener("touchstart",o)}},[s.excludedElementsSelector,n,t])}const M="_popover_vdrbh_1",F="_popoverContent_vdrbh_5",O="_popoverActions_vdrbh_21",x={popover:M,popoverContent:F,popoverActions:O},T=({children:t,text:n,onConfirm:s,onCancel:o})=>{const[r,c]=i.useState(0),a=i.useRef(null),p=i.useRef(null),l=i.useRef(null),[f,m]=i.useState(!1),C=()=>{m(!1),s()},k=()=>{m(!1),o?.()},z=()=>{c(window.innerWidth),m(h=>!h)};return i.useLayoutEffect(()=>{if(p.current&&l.current&&f){const{left:h,width:j}=l.current.getBoundingClientRect(),{width:w}=p.current.getBoundingClientRect();if(l.current.style.bottom="calc(100% + 0.7rem)",r-h-j<20){l.current.style.right="0";return}l.current.style.left=`calc(-${j/2-w/2}px)`}},[f,r]),D({ref:a,onClickOutside:()=>m(!1)}),e.jsxs("div",{ref:a,className:x.popover,children:[f&&e.jsxs("div",{ref:l,className:x.popoverContent,children:[n,e.jsxs("div",{className:x.popoverActions,children:[e.jsx(d,{style:"default",size:"sm",onClick:C,children:"Да"}),e.jsx(d,{style:"white",size:"sm",onClick:k,children:"Нет"})]})]}),e.jsx("div",{onClick:z,ref:p,children:t})]})},K="_cardActions_13057_1",G={cardActions:K},J=({item:t})=>{const{mutate:n,isPending:s}=B(t.id);return e.jsxs("div",{className:G.cardActions,children:[e.jsx(d,{size:"sm",style:"icon",to:`/edit/${t.id}`,children:e.jsx(_,{})}),e.jsx(T,{onConfirm:n,text:e.jsxs(e.Fragment,{children:["Удалить ",e.jsx("br",{})," ",t.title," ?"]}),children:e.jsx(d,{size:"sm",style:"icon",loading:s,type:"button",children:e.jsx(R,{})})})]})},V=async t=>(await v.patch("/user",t)).data;function X(){const t=y();return g({mutationFn:V,onSuccess:n=>{t.setQueryData(["getUserData"],n)}})}const Y="_profileHeader_ji570_1",Z="_profileInfo_ji570_7",ee="_profileContent_ji570_12",te="_nick_ji570_16",ne="_line_ji570_22",u={profileHeader:Y,profileInfo:Z,profileContent:ee,nick:te,line:ne},se=()=>{const{i18n:t}=Q(),{data:n}=P(),{mutateAsync:s,isPending:o}=X(),r=async()=>{const c=n?.language==="ru"?"en":"ru";s({language:c}).then(a=>{t.changeLanguage(a.language)})};return e.jsxs("div",{className:u.profileHeader,children:[e.jsxs("div",{className:u.profileInfo,children:[e.jsx(I,{image:n?.avatar}),e.jsxs("div",{className:u.profileContent,children:[e.jsx("p",{className:u.nick,children:n?.first_name||n?.username}),e.jsx("p",{className:u.line,children:"Создано: 0"}),e.jsx("p",{className:u.line,children:"Пройдено: 0"})]})]}),e.jsx(d,{size:"sm",auto:!0,loading:o,onClick:r,after:e.jsx(q,{}),children:n?.language==="ru"?"RU":"EN"})]})};function he(){return e.jsx(A,{children:e.jsxs("div",{className:U.container,children:[e.jsx(se,{}),e.jsx(b,{title:"Созданные квизы",actions:e.jsx(d,{size:"sm",to:"/create",after:e.jsx(_,{}),children:"Новый"})}),e.jsx(E,{listKey:"profile-page",params:{type:"my"},renderItem:({data:t})=>e.jsx(N,{image:L(t.poster),title:t.title,link:`quiz/${t.id}`,actions:e.jsx(J,{item:t})},t.id)})]})})}export{he as default};
