import{c as v,d as g,r as i,j as e,B as L}from"./index-UPycLL-e.js";import{u as E,Q as A,a as N}from"./useQuizListQuery-BURc4er7.js";import{P as Q}from"./page-layout-ujEcNr1G.js";import{c as S,B as u,u as R}from"./Button-B4QhbFUk.js";import{S as P}from"./SectionHeader-BwSW-0CK.js";import{u as j}from"./useMutation-C_jaUH5d.js";import{S as _}from"./square-pen-DNj26E3t.js";import{T as b}from"./trash-2-DUpdzWPN.js";import{u as B,A as I}from"./useUserQuery-DKhLVE4U.js";import"./useQuery-Dm2FfCmC.js";const $=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],q=S("globe",$),H="_container_lkrrv_1",U={container:H},W=async n=>(await v.delete(`/quiz/${n}`))?.data;function D(n){const t=g();return j({mutationFn:()=>W(n),onSuccess:()=>{t.invalidateQueries({queryKey:["getQuizList",{type:"my"}]})}})}function M({onClickOutside:n,ref:t,options:s={}}){i.useEffect(()=>{const o=r=>{const c=s.excludedElementsSelector,a=c&&c.some(p=>!!r.target.closest(p));!t.current||t.current.contains(r.target)||a||n(r)};return document.addEventListener("mousedown",o),document.addEventListener("touchstart",o),()=>{document.removeEventListener("mousedown",o),document.removeEventListener("touchstart",o)}},[s.excludedElementsSelector,t,n])}const F="_popover_vdrbh_1",O="_popoverContent_vdrbh_5",T="_popoverActions_vdrbh_21",x={popover:F,popoverContent:O,popoverActions:T},K=({children:n,text:t,onConfirm:s,onCancel:o})=>{const[r,c]=i.useState(0),a=i.useRef(null),p=i.useRef(null),l=i.useRef(null),[f,m]=i.useState(!1),C=()=>{m(!1),s()},k=()=>{m(!1),o?.()},w=()=>{c(window.innerWidth),m(h=>!h)};return i.useLayoutEffect(()=>{if(p.current&&l.current&&f){const{left:h,width:y}=l.current.getBoundingClientRect(),{width:z}=p.current.getBoundingClientRect();if(l.current.style.bottom="calc(100% + 0.7rem)",r-h-y<20){l.current.style.right="0";return}l.current.style.left=`calc(-${y/2-z/2}px)`}},[f,r]),M({ref:a,onClickOutside:()=>m(!1)}),e.jsxs("div",{ref:a,className:x.popover,children:[f&&e.jsxs("div",{ref:l,className:x.popoverContent,children:[t,e.jsxs("div",{className:x.popoverActions,children:[e.jsx(u,{style:"default",size:"sm",onClick:C,children:"Да"}),e.jsx(u,{style:"white",size:"sm",onClick:k,children:"Нет"})]})]}),e.jsx("div",{onClick:w,ref:p,children:n})]})},G="_cardActions_13057_1",J={cardActions:G},V=({item:n})=>{const{mutate:t,isPending:s}=D(n.id);return e.jsxs("div",{className:J.cardActions,children:[e.jsx(u,{size:"sm",style:"icon",to:`/edit/${n.id}`,children:e.jsx(_,{})}),e.jsx(K,{onConfirm:t,text:e.jsxs(e.Fragment,{children:["Удалить ",e.jsx("br",{})," ",n.title," ?"]}),children:e.jsx(u,{size:"sm",style:"icon",loading:s,type:"button",children:e.jsx(b,{})})})]})},X=async n=>(await v.patch("/user",n)).data;function Y(){const n=g();return j({mutationFn:X,onSuccess:t=>{n.setQueryData(["getUserData"],t)}})}const Z="_profileHeader_ywmlk_1",ee="_profileInfo_ywmlk_7",te="_profileContent_ywmlk_12",ne="_nick_ywmlk_16",se="_line_ywmlk_22",d={profileHeader:Z,profileInfo:ee,profileContent:te,nick:ne,line:se},oe=()=>{const{i18n:n}=R(),{data:t}=B(),{mutateAsync:s,isPending:o}=Y(),r=async()=>{const c=t?.language==="ru"?"en":"ru";s({language:c}).then(a=>{n.changeLanguage(a.language)})};return e.jsxs("div",{className:d.profileHeader,children:[e.jsxs("div",{className:d.profileInfo,children:[e.jsx(I,{image:t?.avatar}),e.jsxs("div",{className:d.profileContent,children:[e.jsx("p",{className:d.nick,children:t?.first_name||t?.username}),e.jsx("p",{className:d.line,children:"Создано: 0"}),e.jsx("p",{className:d.line,children:"Пройдено: 0"})]})]}),e.jsx(u,{size:"sm",auto:!0,loading:o,onClick:r,after:e.jsx(q,{}),children:t?.language==="ru"?"RU":"EN"})]})};function he(){const{isLoading:n,data:t}=E({type:"my"});return e.jsx(Q,{children:e.jsxs("div",{className:U.container,children:[e.jsx(oe,{}),e.jsx(P,{title:"Созданные квизы",actions:e.jsx(u,{size:"sm",to:"/create",after:e.jsx(_,{}),children:"Новый"})}),e.jsx(A,{listKey:"profile-page",isLoading:n,data:t,renderItem:s=>e.jsx(N,{image:L+s.poster,title:s.title,link:`quiz/${s.id}`,actions:e.jsx(V,{item:s})},s.id)})]})})}export{he as default};
