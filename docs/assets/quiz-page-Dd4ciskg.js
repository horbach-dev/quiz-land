import{r as m,j as r,c as $,K as He,f as Be,h as Ye,d as D,e as Ce,M as k,i as We}from"./index-BViiGnCv.js";import{u as ie}from"./useQuery-BHPkRtKW.js";import{b as Z,P as Oe}from"./page-layout-6nSppNve.js";import{c as W,B as Y,a as Ke}from"./Button-uA8O_c__.js";import{S as Ue}from"./share-D_dzn7Xl.js";import{u as ae}from"./useMutation-CGdvt3ok.js";import{r as Ne}from"./index-DAwEm20B.js";import{u as Ve}from"./popupStore-BHZ4cIir.js";import"./useBaseQuery-Cn-GaRnJ.js";const Ge=[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]],Xe=W("chevrons-left",Ge);const Ze=[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]],De=W("chevrons-right",Ze);const Je=[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]],et=W("flag",Je);const tt=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],ye=W("play",tt);const nt=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],st=W("rotate-ccw",nt);function rt(e){return ie({queryKey:["getCompletedSession",e],enabled:!1,queryFn:()=>new Promise(n=>{n({})})})}const ot="_container_1nkq2_1",it="_containerLoading_1nkq2_17",at="_move_1nkq2_1",ct="_image_1nkq2_33",lt="_imageLoaded_1nkq2_42",Q={container:ot,"container-content":"_container-content_1nkq2_13",containerLoading:it,move:at,image:ct,imageLoaded:lt},ce=({image:e,title:n,fit:s="cover",className:l})=>{const[a,d]=m.useState(!0);return r.jsx("div",{className:$(Q.container,Q[`container-${s}`],a&&Q.containerLoading,a&&Q.containerLoading,l),children:r.jsx("img",{className:$(Q.image,!a&&Q.imageLoaded),src:e,alt:n,onLoad:()=>d(!1)})})},ut="_quizCompleted_cg18v_1",dt="_content_cg18v_5",mt="_title_cg18v_9",ht="_poster_cg18v_16",pt="_resultTitle_cg18v_21",gt="_result_cg18v_21",ft="_resultText_cg18v_36",_t="_resultTextResult_cg18v_43",vt="_resultTextCount_cg18v_48",T={quizCompleted:ut,content:dt,title:mt,poster:ht,resultTitle:pt,result:gt,resultText:ft,resultTextResult:_t,resultTextCount:vt},xt="_container_ty462_1",yt="_background_ty462_7",jt="_bad_ty462_11",bt="_middle_ty462_16",St="_good_ty462_21",kt="_circle_ty462_26",Ct="_fillProgress_ty462_1",V={container:xt,background:yt,bad:jt,middle:bt,good:St,circle:kt,fillProgress:Ct},Nt=e=>e>=80?"good":e>=50?"middle":"bad",G=188.495,wt=({percentage:e=0})=>{const n=Math.max(0,Math.min(100,e)),s=G-n/100*G,l=Nt(n);return r.jsx("div",{className:V.container,children:r.jsxs("svg",{className:"progress-ring",width:"100%",height:"100%",viewBox:"0 0 100 100",version:"1.1",style:{"--circumference-value":G,"--offset-value":s},children:[r.jsx("circle",{className:$(V.background),strokeWidth:"5",fill:"transparent",r:"30",cx:"50",cy:"50"}),r.jsx("circle",{className:$(V.circle,V[l]),strokeWidth:"5",fill:"transparent",r:"30",cx:"50",cy:"50",strokeDasharray:G,strokeDashoffset:s,strokeLinecap:"round"})]})})},Lt=({quizData:e})=>{const{data:n}=rt(e.id);return n?r.jsx("div",{className:T.quizCompleted,children:r.jsxs("div",{className:T.content,children:[r.jsx("p",{className:T.title,children:e.title}),e.poster&&r.jsx(ce,{className:T.poster,image:Z(e.poster),title:e?.title}),r.jsx("p",{className:T.resultTitle,children:"Ваш результат"}),r.jsxs("div",{className:T.result,children:[r.jsx(wt,{percentage:(n?.score||0)/n.totalQuestions*100}),r.jsxs("p",{className:T.resultText,children:[r.jsx("span",{className:T.resultTextResult,children:n.score})," / ",r.jsx("span",{className:T.resultTextCount,children:n.totalQuestions})]})]})]})}):null},Mt="_container_b2y0p_1",Et="_title_b2y0p_7",$t="_description_b2y0p_13",It="_resumeButton_b2y0p_21",Tt="_actions_b2y0p_25",At="_skeletonLine_b2y0p_30",Pt="_skeletonActions_b2y0p_37",S={container:Mt,title:Et,description:$t,resumeButton:It,actions:Tt,skeletonLine:At,skeletonActions:Pt},Rt=()=>r.jsxs(r.Fragment,{children:[r.jsx("div",{className:$(S.title,S.skeletonLine),children:"Loading..."}),r.jsxs("div",{className:$(S.actions,S.skeletonActions),children:[r.jsx("div",{className:S.skeletonLine}),r.jsx("div",{className:S.skeletonLine})]}),r.jsxs("div",{className:S.description,children:[r.jsx("div",{className:S.skeletonLine}),r.jsx("div",{className:S.skeletonLine}),r.jsx("div",{className:S.skeletonLine}),r.jsx("div",{className:S.skeletonLine}),r.jsx("div",{className:S.skeletonLine})]})]}),Qt=({quizData:e,onStartSession:n,isLoadingStart:s,isLoadingRestart:l})=>{const a=()=>{He(`${Be}?startapp=${e?.id}`,`Пройди тест: ${e?.title}`)},d=s||l,h=e?.poster?Z(e.poster):void 0;return r.jsxs("div",{className:S.container,children:[r.jsx(ce,{image:h,title:e?.title}),e?r.jsxs(r.Fragment,{children:[r.jsx("p",{className:S.title,children:e?.title}),e?.hasActiveSession&&r.jsx(Y,{disabled:d,loading:s,className:S.resumeButton,onClick:()=>n(),after:r.jsx(ye,{}),children:"Продолжить"}),r.jsxs("div",{className:S.actions,children:[e?.hasActiveSession?r.jsx(Y,{disabled:d,loading:l,onClick:()=>n(!0),after:r.jsx(st,{}),children:"Начать заново"}):r.jsx(Y,{disabled:d,loading:s,onClick:()=>n(),after:r.jsx(ye,{}),children:"Начать"}),r.jsx(Y,{disabled:d,onClick:a,after:r.jsx(Ue,{}),children:"Поделиться"})]}),r.jsx("p",{className:S.description,dangerouslySetInnerHTML:{__html:e?.description||""}})]}):r.jsx(Rt,{})]})};function zt(e){return ie({queryKey:["getQuiz",e],queryFn:()=>Ye(e)})}const qt=e=>{const n={};return e&&e.forEach(s=>{s.submittedOptionIds&&s.submittedOptionIds.length>0&&(n[s.questionId]=s.submittedOptionIds[0])}),n},Ft=(e,n)=>{const s=n?e.findIndex(l=>l.id===n):0;return s===-1||s===void 0?0:s},Ht=async e=>(await D.post(`/quiz-session/complete/${e}`))?.data;function Bt(e){const n=Ce(),{mutateAsync:s,isPending:l,isSuccess:a}=ae({mutationFn:Ht,onSuccess:d=>{n.setQueryData(["getCompletedSession",e],d),n.invalidateQueries({queryKey:["getQuiz",e]})}});return{completeSession:s,isPending:l,isSuccess:a}}const Yt=async e=>(await D.post("/quiz-session/submit-answer",e))?.data;function Wt(){const{mutateAsync:e,isPending:n,isSuccess:s}=ae({mutationFn:Yt});return{submitAnswer:e,isPending:n,isSuccess:s}}function Ot({session:e,quizId:n,timeSpentSeconds:s,questionsLength:l,setScreen:a}){const[d,h]=m.useState({}),{submitAnswer:y,isPending:j}=Wt(),{completeSession:g}=Bt(n);m.useEffect(()=>{e?.userAnswers?.length&&h(qt(e.userAnswers))},[e]);const x=m.useCallback(async({step:M,questionId:C,value:p,goToNextStep:f})=>{if(!(!e.id||!C||j)){h(E=>({...E,[C]:p}));try{await y({sessionId:e.id,questionId:C,timeSpentSeconds:s,submittedOptionIds:[p]}),M+1===l?(await g(e.id),a("finish")):f()}catch(E){console.log("Не удалось отправить ответ",E.message)}}},[e.id,j,s,l]);return{answers:d,isPending:j,submit:x}}const Kt=async e=>(await D.post("/quiz-session/update-time",e))?.data;function Ut(e,n=0){const s=m.useRef(n);return m.useEffect(()=>{if(e)return()=>{e&&Kt({sessionId:e,seconds:s.current}).catch(()=>{})}},[e]),{timeSpent:s}}function Vt({totalSteps:e,initialStep:n=0,transitionDelay:s=300,onEndReached:l}){const[a,d]=m.useState(n),[h,y]=m.useState(!1);m.useEffect(()=>{window.scroll({top:0,behavior:"smooth"})},[a]);const j=m.useCallback(()=>{if(!h){if(a===e-1){l?.();return}y(!0),setTimeout(()=>{y(!1),d(x=>x+1)},s)}},[a,e,h,s,l]),g=m.useCallback(()=>{h||a!==0&&(y(!0),setTimeout(()=>{y(!1),d(x=>x-1)},s))},[a,h,s]);return{step:a,isHide:h,goToNextStep:j,goToPrevStep:g}}function Gt(e){return ie({queryKey:["getSession",e],enabled:!1,queryFn:()=>new Promise(n=>{n({})})})}const Xt="_progressWrap_1xjbf_1",Zt="_progressContainer_1xjbf_38",Dt="_progressCount_1xjbf_45",Jt="_progressIcon_1xjbf_53",en="_progress_1xjbf_1",tn="_progressTrack_1xjbf_67",z={progressWrap:Xt,progressContainer:Zt,progressCount:Dt,progressIcon:Jt,progress:en,progressTrack:tn},nn=document.getElementById("header"),sn=({step:e,timer:n,length:s})=>{const l=m.useRef(null),a=`${(e+1)/s*100}%`;return m.useLayoutEffect(()=>{l?.current?.offsetHeight&&document.documentElement.style.setProperty("--quiz-progress-page-header-height",l.current.offsetHeight+"px")},[]),Ne.createPortal(r.jsxs("div",{ref:l,className:z.progressWrap,children:[n,r.jsxs("div",{className:z.progressContainer,children:[r.jsxs("div",{className:z.progressCount,children:[e+1," / ",s]}),r.jsx("div",{className:z.progress,children:r.jsx("div",{style:{width:a},className:z.progressTrack})}),r.jsx(et,{className:z.progressIcon})]})]}),nn)},rn="_container_yipxk_1",on="_content_yipxk_17",je={container:rn,content:on},an="_container_1jn3i_1",cn="_containerImages_1jn3i_8",ln="_item_1jn3i_13",un="_itemActive_1jn3i_30",dn="_itemImage_1jn3i_39",mn="_itemLoading_1jn3i_49",q={container:an,containerImages:cn,item:ln,itemActive:un,itemImage:dn,itemLoading:mn},hn=({isLoading:e,isImage:n,options:s,value:l,onChange:a})=>r.jsx("div",{className:$(q.container,n&&q.containerImages),children:s.map((d,h)=>{const y=l===d.value;return r.jsxs("button",{type:"button",className:$(q.item,y&&q.itemActive,n&&q.itemImage),onClick:()=>a(d.value),children:[n?r.jsx("img",{src:d?.image||"",alt:`image-${h}`}):d.label,e&&y&&r.jsx("span",{className:q.itemLoading})]},d.value)})});function we(e){let n=k.useRef(e);return k.useEffect(()=>{n.current=e}),k.useMemo(()=>(...s)=>{var l;return(l=n.current)==null?void 0:l.call(n,...s)},[])}function pn({defaultProp:e,onChange:n}){let s=k.useState(e),[l]=s,a=k.useRef(l),d=we(n);return k.useEffect(()=>{a.current!==l&&(d(l),a.current=l)},[l,a,d]),s}function gn({prop:e,defaultProp:n,onChange:s=()=>{}}){let[l,a]=pn({defaultProp:n,onChange:s}),d=e!==void 0,h=d?e:l,y=we(s),j=k.useCallback(g=>{if(d){let x=typeof g=="function"?g(e):g;x!==e&&y(x)}else a(g)},[d,e,a,y]);return[h,j]}var be=.3,fn=30,_n=e=>Math.pow(e-1,3)+1,oe=(e,n,s)=>Math.max(n,Math.min(e,s)),vn=({className:e,children:n})=>k.createElement("div",{className:e,"data-rwp-wrapper":!0},n);function xn({defaultValue:e,value:n,onValueChange:s,options:l,infinite:a=!1,visibleCount:d=20,dragSensitivity:h=3,scrollSensitivity:y=5,optionItemHeight:j=30,classNames:g}){var x;let[M=(x=l[0])==null?void 0:x.value,C]=gn({defaultProp:e,prop:n,onChange:s}),p=m.useMemo(()=>{if(!a)return l;let t=[],o=Math.ceil(d/2);if(l.length===0)return t;for(;t.length<o;)t.push(...l);return t},[d,l,a]),f=j,E=f*.5,b=360/d,P=f/Math.tan(b*Math.PI/180),Le=Math.round(P*2+f*.25),A=d>>2,le=h*10,Me=10,N=m.useRef(null),O=m.useRef(null),J=m.useRef(null),w=m.useRef(0),ue=m.useRef(0),R=m.useRef(!1),de=m.useRef(0),ee=m.useRef({startY:0,yList:[],touchScroll:0,isClick:!0}),te=m.useRef(null),Ee=m.useMemo(()=>{let t=(i,c,u)=>k.createElement("li",{key:c,className:g?.optionItem,"data-slot":"option-item","data-rwp-option":!0,"data-index":c,style:{top:-E,height:f,lineHeight:`${f}px`,transform:`rotateX(${u}deg) translateZ(${P}px)`,visibility:"hidden"}},i.label),o=p.map((i,c)=>t(i,c,-b*c));if(a)for(let i=0;i<A;++i){let c=-i-1,u=i+p.length;o.unshift(t(p[p.length-i-1],c,b*(i+1))),o.push(t(p[i],u,-b*u))}return o},[f,E,a,b,p,A,P,g?.optionItem]),$e=m.useMemo(()=>{let t=(i,c)=>k.createElement("li",{key:c,className:g?.highlightItem,"data-slot":"highlight-item","data-rwp-highlight-item":!0,style:{height:f}},i.label),o=p.map((i,c)=>t(i,c));if(a){let i=p[0],c=p[p.length-1];o.unshift(t(c,"infinite-start")),o.push(t(i,"infinite-end"))}return o},[g?.highlightItem,f,a,p]),Ie=m.useMemo(()=>{let t=0,o=Math.PI/180,i=[];for(let c=A-1;c>=-A+1;--c){let u=c*b,v=f*Math.cos(u*o),_=t;t+=v,i.push([_,t])}return i},[b,f,A]),ne=t=>(t%p.length+p.length)%p.length,F=t=>{let o=a?ne(t):t;if(O.current){let i=`translateZ(${-P}px) rotateX(${b*o}deg)`;O.current.style.transform=i,O.current.childNodes.forEach(c=>{let u=c,v=Math.abs(Number(u.dataset.index)-o);u.style.visibility=v>A?"hidden":"visible"})}return J.current&&(J.current.style.transform=`translateY(${-o*f}px)`),o},K=()=>{cancelAnimationFrame(ue.current)},me=(t,o,i,c)=>{if(t===o||i===0){F(t);return}let u=performance.now(),v=o-t,_=L=>{let I=(L-u)/1e3;if(I<i){let re=_n(I/i);w.current=F(t+re*v),ue.current=requestAnimationFrame(_)}else K(),w.current=F(o),c?.()};requestAnimationFrame(_)},U=t=>{let o=ne(t)|0,i=a?o:Math.min(Math.max(o,0),p.length-1);if(!a&&i!==t)return;w.current=F(i);let c=p[w.current];C(c.value)},Te=t=>{let o=p.findIndex(i=>i.value===t);if(o===-1){console.error("Invalid value selected:",t);return}K(),U(o)},he=t=>{let o=w.current,i=o+t;a?i=Math.round(i):i=oe(Math.round(i),0,p.length-1);let c=Math.abs(i-o);if(c===0)return;let u=Math.sqrt(c/y);K(),me(o,i,u,()=>{U(w.current)})},Ae=t=>{let o=N.current;if(!o){console.error("Container reference is not set.");return}let{top:i}=o.getBoundingClientRect(),c=t-i,u=Ie.findIndex(([_,L])=>c>=_&&c<=L);if(u===-1){console.error("No item found for click position:",c);return}let v=(A-u-1)*-1;he(v)},Pe=t=>{var o,i;try{let c=(t instanceof MouseEvent?t.clientY:(i=(o=t.touches)==null?void 0:o[0])==null?void 0:i.clientY)||0,u=ee.current;u.isClick&&Math.abs(c-u.startY)>5&&(u.isClick=!1),u.yList.push([c,Date.now()]),u.yList.length>5&&u.yList.shift();let v=(u.startY-c)/f,_=w.current+v;if(a)_=ne(_);else{let L=p.length;_<0?_*=be:_>L&&(_=L+(_-L)*be)}u.touchScroll=F(_)}catch(c){console.error("Error in updateScrollDuringDrag:",c)}},pe=t=>{var o;!R.current&&!((o=N.current)!=null&&o.contains(t.target))&&t.target!==N.current||(t.cancelable&&t.preventDefault(),p.length&&Pe(t))},ge=t=>{var o,i,c;try{R.current=!0;let u=new AbortController,{signal:v}=u;te.current=u;let _={signal:v,passive:!1};(o=N.current)==null||o.addEventListener("touchmove",pe,_),document.addEventListener("mousemove",pe,_);let L=(t instanceof MouseEvent?t.clientY:(c=(i=t.touches)==null?void 0:i[0])==null?void 0:c.clientY)||0,I=ee.current;I.startY=L,I.yList=[[L,Date.now()]],I.touchScroll=w.current,I.isClick=!0,K()}catch(u){console.error("Error in initiateDragGesture:",u)}},H=m.useCallback(t=>{var o;let i=R.current,c=!!((o=N.current)!=null&&o.contains(t.target))||t.target===N.current;(i||c)&&t.cancelable&&(t.preventDefault(),p.length&&ge(t))},[ge]),Re=t=>{let o=w.current,i=o,c=t>0?-le:le,u=0;if(a){u=Math.abs(t/c);let v=t*u+.5*c*u*u;i=Math.round(o+v)}else if(o<0||o>p.length-1){let v=oe(o,0,p.length-1),_=o-v;c=Me,u=Math.sqrt(Math.abs(_/c)),t=c*u,t=o>0?-t:t,i=v}else{u=Math.abs(t/c);let v=t*u+.5*c*u*u;i=Math.round(o+v),i=oe(i,0,p.length-1);let _=i-o;u=Math.sqrt(Math.abs(_/c))}me(o,i,u,()=>{U(w.current)}),U(w.current)},fe=()=>{var t,o,i,c;try{(t=te.current)==null||t.abort(),te.current=null;let u=ee.current;if(u.isClick){Ae(u.startY);return}let v=u.yList,_=0;if(v.length>1){let L=v.length,[I,re]=(o=v[L-2])!=null?o:[0,0],[Qe,ze]=(i=v[L-1])!=null?i:[0,0],ve=ze-re;if(ve>0){let xe=(I-Qe)/f*1e3/ve,qe=fn,Fe=xe>0?1:-1;_=Math.min(Math.abs(xe),qe)*Fe}}w.current=(c=u.touchScroll)!=null?c:w.current,Re(_)}catch(u){console.error("Error in finalizeDragAndStartInertiaScroll:",u)}finally{R.current=!1}},B=m.useCallback(t=>{var o;if(!p.length)return;let i=R.current,c=!!((o=N.current)!=null&&o.contains(t.target))||t.target===N.current;(i||c)&&t.cancelable&&(t.preventDefault(),fe())},[fe]),_e=t=>{t.preventDefault();let o=Date.now();if(o-de.current<100)return;let i=Math.sign(t.deltaY);i&&(de.current=o,he(i))},se=m.useCallback(t=>{if(!p.length||!N.current)return;let o=R.current,i=N.current.contains(t.target)||t.target===N.current;(o||i)&&t.cancelable&&(t.preventDefault(),_e(t))},[_e]);return m.useEffect(()=>{let t=N.current;if(!t)return;let o={passive:!1};return t.addEventListener("touchstart",H,o),t.addEventListener("touchend",B,o),t.addEventListener("wheel",se,o),document.addEventListener("mousedown",H,o),document.addEventListener("mouseup",B,o),()=>{t.removeEventListener("touchstart",H),t.removeEventListener("touchend",B),t.removeEventListener("wheel",se),document.removeEventListener("mousedown",H),document.removeEventListener("mouseup",B)}},[B,H,se]),m.useEffect(()=>{Te(M)},[M,n,p]),k.createElement("div",{ref:N,"data-rwp":!0,style:{height:Le}},k.createElement("ul",{ref:O,"data-rwp-options":!0},Ee),k.createElement("div",{className:g?.highlightWrapper,"data-rwp-highlight-wrapper":!0,"data-slot":"highlight-wrapper",style:{height:f,lineHeight:`${f}px`}},k.createElement("ul",{ref:J,"data-rwp-highlight-list":!0,style:{top:a?-f:void 0}},$e)))}const yn=window.innerWidth*12/100,jn=({options:e,value:n,onValueChange:s})=>r.jsx(vn,{children:r.jsx(xn,{options:e,optionItemHeight:yn,value:n,onValueChange:s})}),bn="_container_1soom_1",Sn="_title_1soom_11",kn="_hide_1soom_17",Cn="_disabled_1soom_24",X={container:bn,title:Sn,hide:kn,disabled:Cn},Nn=m.memo(({isHide:e,isLoading:n,question:s,value:l,setValue:a})=>{const d=s.options.map(h=>({image:h.image?Z(h.image):null,label:h.text,value:h.id}));return r.jsxs("div",{className:$(X.container,e&&X.hide,n&&X.disabled),children:[s.image&&r.jsx(ce,{fit:"content",image:Z(s.image),title:s.text},s.id),r.jsx("p",{className:X.title,children:s.text}),s.type==="MULTI_CHOICE"&&r.jsx(jn,{onValueChange:a,options:d,value:l}),s.type==="SINGLE_CHOICE"&&r.jsx(hn,{isLoading:n,value:l,isImage:!!s.options[0].image,options:d,onChange:a})]})}),wn="_timer_13st3_1",Ln={timer:wn},Mn=({timeSpent:e})=>{const n=e?.current||0,[s,l]=m.useState(n),a=m.useRef(performance.now()-n*1e3),d=m.useRef(null),h=m.useCallback(j=>{const g=j-a.current,x=Math.floor(g/1e3);x!==s&&(e?.current!==void 0&&(e.current=x),l(x)),d.current=requestAnimationFrame(h)},[s]);m.useEffect(()=>(d.current=requestAnimationFrame(h),()=>{d.current&&cancelAnimationFrame(d.current)}),[h]);const y=m.useCallback(j=>{const g=Math.floor(j/3600),x=Math.floor(j%3600/60),M=j%60,C=p=>p.toString().padStart(2,"0");return`${g?`${C(g)}:`:""}${C(x)}:${C(M)}`},[]);return r.jsx("div",{className:Ln.timer,children:y(s)})},En="_container_1cxzz_1",$n="_content_1cxzz_45",Se={container:En,content:$n},In=document.getElementById("footer"),Tn=({disabled:e,isDone:n,onClick:s})=>Ne.createPortal(r.jsx("div",{className:Se.container,children:r.jsx("div",{className:Se.content,children:r.jsx(Y,{onClick:s,disabled:e,before:!n&&r.jsx(Xe,{}),after:n&&r.jsx(De,{}),children:n?"Поделиться":"Назад"})})}),In);function An({quizData:e,setScreen:n}){const{data:s}=Gt(e.id),l=s?.session,a=e.questions,d=m.useMemo(()=>Ft(a,s?.nextQuestionId),[a,s?.nextQuestionId]),{step:h,isHide:y,goToNextStep:j,goToPrevStep:g}=Vt({initialStep:d,totalSteps:a.length}),{timeSpent:x}=Ut(l?.id,s?.session?.timeSpentSeconds),{answers:M,submit:C,isPending:p}=Ot({session:l,quizId:e.id,setScreen:n,questionsLength:a.length,timeSpentSeconds:x.current}),f=a[h],E=P=>C({questionId:f.id,value:P,step:h,goToNextStep:j});if(!f||!l)return null;const b=M[f.id];return r.jsxs("div",{className:je.container,children:[r.jsxs("div",{className:je.content,children:[r.jsx(sn,{step:h,timer:r.jsx(Mn,{timeSpent:x}),length:a.length}),r.jsx(Nn,{isHide:y,isLoading:p,value:b||"",setValue:E,question:f})]}),r.jsx(Tn,{isDone:!1,disabled:h===0,onClick:g})]})}const Pn=async({id:e,restart:n})=>(await D.post(`/quiz-session/start/${e}`,{restart:n}))?.data;function Rn(e){const[n,s]=m.useState(!1),l=Ce(),{isPending:a,mutateAsync:d}=ae({mutationFn:({restart:h})=>Pn({id:e,restart:h}),onMutate:({restart:h})=>s(!!h),onSuccess:h=>{l.setQueryData(["getSession",e],h),l.invalidateQueries({queryKey:["getQuiz",e]})}});return{startSession:d,isLoadingStart:a&&!n,isLoadingRestart:a&&n,isPending:a}}const Qn="_container_7jg9t_1",zn="_containerTransition_7jg9t_6",ke={container:Qn,containerTransition:zn},qn={main:Qt,session:An,finish:Lt};function Gn(){const e=Ke(b=>b.setSwipeRedirectCallback),n=Ve(b=>b.openPopup),[s,l]=m.useState(!1),[a,d]=m.useState("main"),{id:h}=We(),{data:y,error:j}=zt(h),{startSession:g,isLoadingStart:x,isLoadingRestart:M}=Rn(h),C=b=>{g({restart:b}).then(()=>f("session"))},p=m.useCallback(()=>{n("sessionEndConfirmation",{onConfirm:()=>d("main")})},[n]),f=b=>{l(!0),setTimeout(()=>{l(!1),d(b)},300)};m.useEffect(()=>{j&&n("quizError",{text:"Похоже такого теста не существует :(",overlayClose:!1})},[j,n]),m.useEffect(()=>(a==="session"?e(p):a==="finish"&&e(()=>d("main")),()=>{e("default")}),[p,a,e]);const E=qn[a];return r.jsx(Oe,{backCallback:a==="session"?p:void 0,withNavigation:a!=="session",children:r.jsx("div",{className:$(ke.container,s&&ke.containerTransition),children:r.jsx(E,{quizData:y,onStartSession:C,isLoadingStart:x,isLoadingRestart:M,setScreen:f})})})}export{Gn as default};
