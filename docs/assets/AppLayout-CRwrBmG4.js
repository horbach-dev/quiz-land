import{r as i,J as k,c as S,H as O,u as b,a as w,j as n,b as y,n as A,d as P,C as g,e as _,m as j,O as R,S as I}from"./index-CYje_tYt.js";import{C as T}from"./circle-check-big-CP6KsVbB.js";import{u as z}from"./useTranslation-D2SXJAgb.js";import{r as E}from"./index-BC_GV2LF.js";import{u as $,r as W}from"./popupStore-CTpCDV8x.js";import{B as M}from"./Background-DRjT01az.js";import"./buildUrl-Bp3NZAaf.js";import"./trash-2-p67d02cx.js";function C(e){return i.useMemo(()=>k(),[e])}const X=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],B=S("chevron-left",X);const H=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],q=S("user",H),V=[{id:1,title:"navigation.main",icon:O,link:"/"},{id:2,title:"navigation.quizzes",icon:T,link:"/quizzes"},{id:3,title:"navigation.profile",icon:q,link:"/profile"}],Y="_container_kfp16_1",F="_list_kfp16_16",G="_hide_kfp16_51",D="_item_kfp16_55",J="_active_kfp16_84",U="_icon_kfp16_88",l={container:Y,list:F,hide:G,item:D,active:J,icon:U},K=()=>{const{t:e}=z(),t=i.useRef(null),s=b(o=>o.isNavigationVisible),{pathname:c}=w();return i.useLayoutEffect(()=>{t?.current?.offsetHeight&&document.documentElement.style.setProperty("--navigation-height",t.current.offsetHeight+"px")},[]),n.jsx("div",{className:y(l.container,!s&&l.hide),children:n.jsx("div",{ref:t,className:l.list,children:V.map(({id:o,link:r,title:a,icon:p})=>{const h=c.includes(r)&&r!=="/"||c===r;return n.jsxs("button",{type:"button",className:y(l.item,h&&l.active),onClick:()=>A(r),children:[n.jsx(p,{className:l.icon}),e(a)]},o)})})})},Q="_popup_1snhx_1",Z="_popupOverlay_1snhx_11",tt="_popupWrap_1snhx_21",et="_popupContent_1snhx_32",nt="_popupClose_1snhx_42",st="_popupOpen_1snhx_50",d={popup:Q,popupOverlay:Z,popupWrap:tt,popupContent:et,popupClose:nt,popupOpen:st},ot=300,ct=({isOpen:e,children:t,onClose:s})=>{const[c,o]=i.useState(!1);return i.useEffect(()=>{e?(document.body.style.overflow="hidden",o(!0)):(document.body.style.overflow="",setTimeout(()=>o(!1),ot))},[e]),c?n.jsxs("div",{className:y(d.popup,e?d.popupOpen:d.popupClose),children:[n.jsx("div",{className:d.popupOverlay,onClick:s}),n.jsx("div",{className:d.popupWrap,children:n.jsx("div",{className:d.popupContent,children:t})})]}):null},rt=document.getElementById("modals"),it=()=>{const e=$(t=>t.popups);return E.createPortal(e.toSorted((t,s)=>t.lastOpen-s.lastOpen).map(({name:t,isOpen:s,close:c,params:o})=>{const r=W[t];return r?n.jsx(ct,{isOpen:s,onClose:()=>o?.overlayClose?c():null,children:n.jsx(r,{close:c,...o})},t):null}),rt)},at=(e,t=300)=>{let s;return(...c)=>{clearTimeout(s),s=setTimeout(()=>e(...c),t)}},N=()=>({width:window.innerWidth,height:window.innerHeight}),ut=()=>{const[e,t]=i.useState(N);return i.useEffect(()=>{const s=at(()=>t(N));return window.addEventListener("resize",s),()=>{window.removeEventListener("resize",s)}},[]),e},pt="_container_1xqeb_1",lt={container:pt},dt=document.getElementById("modals"),mt=()=>{const{width:e,height:t}=ut();return t>e+t/4?null:E.createPortal(n.jsx("div",{className:lt.container,children:n.jsxs("p",{children:["Пожалуйста ",n.jsx("br",{})," поверните устройство"]})}),dt)},m=document.getElementById("root"),x=85,f=20,ft=(e,t)=>{i.useEffect(()=>{if(!t)return;let s=0,c=0,o=0,r=0;function a(u){c=u.touches[0].clientX,s=u.touches[0].clientY,o=0,r=0}function p(u){if(o=u.touches[0].clientX,r=u.touches[0].clientY,e.current){e.current.style.transition="none";const v=o-c-Math.abs(r-s)-f;if(v<f)e.current.style.transform=`translateX(${v}px)`;else{const L=Math.min((v-f)*2,x);e.current.style.transform=`scale(${L/(x*2)+1}) translateX(${f}px)`}}}function h(){if(e.current&&(e.current.style.transition="transform 0.3s",e.current.style.transform="translateX(0) scale(1)"),o===0)return;const u=o-c-Math.abs(r-s)-f;Math.abs(u)>x&&u>0&&t&&t(),c=0,s=0,o=0,r=0}return m.addEventListener("touchstart",a),m.addEventListener("touchmove",p),m.addEventListener("touchend",h),()=>{m.removeEventListener("touchstart",a),m.removeEventListener("touchmove",p),m.removeEventListener("touchend",h)}},[t])},ht="_container_19f8i_1",vt={container:ht},_t=document.getElementById("swipe"),xt=()=>{const e=b(s=>s.swipeRedirectCallback),t=i.useRef(null);return ft(t,e),E.createPortal(n.jsx("div",{className:vt.container,ref:t,children:n.jsx(B,{})}),_t)},yt="_layout_ae4of_1",Et={layout:yt};function gt(){const[e,t]=i.useState(!1),{tgWebAppStartParam:s}=C(),c=P(),{pathname:o}=w();function r({detail:a}){a?.pathname!==o&&a?.pathname&&c(a.pathname==="back-navigate"?-1:a.pathname)}return i.useEffect(()=>{if(s&&!e){t(!0);const[a,p]=s.replaceAll('"',"").split("&&");p==="start"&&c(`quiz/${a}`),p==="completed"&&c(`completed/${a}`)}},[s,e,c]),i.useEffect(()=>(document.addEventListener(g,r),()=>{document.removeEventListener(g,r)}),[o]),{pathname:o}}const jt=["ios","android"];function Nt(){const{tgWebAppPlatform:e}=C(),t=jt.includes(e);return i.useLayoutEffect(()=>{_?.isSupported()&&(_?.mount(),_?.disableVertical()),t&&j.requestFullscreen?.isAvailable()&&j.requestFullscreen()},[t]),{isMobile:t}}function Pt(){const{pathname:e}=gt(),{isMobile:t}=Nt();return n.jsxs(n.Fragment,{children:[n.jsx(M,{}),n.jsx("div",{className:Et.layout,children:n.jsx(R,{})}),n.jsx(I,{}),n.jsx(K,{}),e!=="/"&&n.jsx(xt,{}),t&&e!=="/create"&&n.jsx(mt,{}),n.jsx(it,{})]})}export{Pt as default};
