import{r as u,J as L,c as x,u as b,a as N,j as s,b as y,n as P,d as S,C as g,e as v,m as j,O as C,S as R}from"./index-CpQMeG-6.js";import{u as $,a as I}from"./useCssVarElementHeight-F1kxK2wf.js";import{C as M}from"./circle-check-big-DG8-FAxh.js";import{u as O}from"./useTranslation-lpBjxsq-.js";import{r as E}from"./index-Bz21J2Zd.js";import{P as T}from"./Popup-BLcmoh2i.js";import{u as X,r as w}from"./popupStore-DbL85jjQ.js";import{B as z}from"./Background-DYvGlzno.js";function k(e){return u.useMemo(()=>L(),[e])}const B=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],V=x("chevron-left",B);const q=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]],H=x("house",q);const W=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Y=x("user",W),F=[{id:1,title:"navigation.main",icon:H,link:"/"},{id:2,title:"navigation.quizzes",icon:M,link:"/quizzes"},{id:3,title:"navigation.profile",icon:Y,link:"/profile"}],G="_container_kfp16_1",D="_list_kfp16_16",J="_hide_kfp16_51",U="_item_kfp16_55",K="_active_kfp16_84",Q="_icon_kfp16_88",d={container:G,list:D,hide:J,item:U,active:K,icon:Q},Z=()=>{const{t:e}=O(),t=b(o=>o.isNavigationVisible),{pathname:n}=N(),c=$("--navigation-height");return s.jsx("div",{className:y(d.container,!t&&d.hide),children:s.jsx("div",{ref:c,className:d.list,children:F.map(({id:o,link:a,title:r,icon:l})=>{const f=n.includes(a)&&a!=="/"||n===a;return s.jsxs("button",{type:"button",className:y(d.item,f&&d.active),onClick:()=>P(a),children:[s.jsx(l,{className:d.icon}),e(r)]},o)})})})},tt=document.getElementById("modals"),et=()=>{const e=X(t=>t.popups);return E.createPortal(e.toSorted((t,n)=>t.lastOpen-n.lastOpen).map(({name:t,isOpen:n,close:c,params:o})=>{const a=w[t];return a?s.jsx(T,{isOpen:n,onClose:()=>o?.overlayClose?c():null,children:s.jsx(a,{close:c,...o})},t):null}),tt)},st="_container_1xqeb_1",nt={container:st},ot=document.getElementById("modals"),at=()=>{const{width:e,height:t}=I();return t>e+t/4?null:E.createPortal(s.jsx("div",{className:nt.container,children:s.jsxs("p",{children:["Пожалуйста ",s.jsx("br",{})," поверните устройство"]})}),ot)},m=document.getElementById("root"),_=85,p=20,ct=(e,t)=>{u.useEffect(()=>{if(!t)return;let n=0,c=0,o=0,a=0;function r(i){c=i.touches[0].clientX,n=i.touches[0].clientY,o=0,a=0}function l(i){if(o=i.touches[0].clientX,a=i.touches[0].clientY,e.current){e.current.style.transition="none";const h=o-c-Math.abs(a-n)-p;if(h<p)e.current.style.transform=`translateX(${h}px)`;else{const A=Math.min((h-p)*2,_);e.current.style.transform=`scale(${A/(_*2)+1}) translateX(${p}px)`}}}function f(){if(e.current&&(e.current.style.transition="transform 0.3s",e.current.style.transform="translateX(0) scale(1)"),o===0)return;const i=o-c-Math.abs(a-n)-p;Math.abs(i)>_&&i>0&&t&&t(),c=0,n=0,o=0,a=0}return m.addEventListener("touchstart",r),m.addEventListener("touchmove",l),m.addEventListener("touchend",f),()=>{m.removeEventListener("touchstart",r),m.removeEventListener("touchmove",l),m.removeEventListener("touchend",f)}},[t])},rt="_container_19f8i_1",it={container:rt},lt=document.getElementById("swipe"),ut=()=>{const e=b(n=>n.swipeRedirectCallback),t=u.useRef(null);return ct(t,e),E.createPortal(s.jsx("div",{className:it.container,ref:t,children:s.jsx(V,{})}),lt)},dt="_layout_ae4of_1",mt={layout:dt};function pt(){const[e,t]=u.useState(!1),{tgWebAppStartParam:n}=k(),c=S(),{pathname:o}=N();function a({detail:r}){r?.pathname!==o&&r?.pathname&&c(r.pathname==="back-navigate"?-1:r.pathname)}return u.useEffect(()=>{if(n&&!e)try{t(!0);const[r,l]=n.replaceAll('"',"").split("split");l==="start"&&c(`quiz/${r}`),l==="completed"&&c(`completed/${r}`)}catch(r){console.error("не удалось распарсить ссылку",r)}},[n,e,c]),u.useEffect(()=>(document.addEventListener(g,a),()=>{document.removeEventListener(g,a)}),[o]),{pathname:o}}const ft=["ios","android"];function ht(){const{tgWebAppPlatform:e}=k(),t=ft.includes(e);return u.useLayoutEffect(()=>{v?.isSupported()&&(v?.mount(),v?.disableVertical()),t&&j.requestFullscreen?.isAvailable()&&j.requestFullscreen()},[t]),{isMobile:t}}function Nt(){const{pathname:e}=pt(),{isMobile:t}=ht();return s.jsxs(s.Fragment,{children:[s.jsx(z,{}),s.jsx("div",{className:mt.layout,children:s.jsx(C,{})}),s.jsx(R,{}),s.jsx(Z,{}),e!=="/"&&s.jsx(ut,{}),t&&e!=="/create"&&s.jsx(at,{}),s.jsx(et,{})]})}export{Nt as default};
